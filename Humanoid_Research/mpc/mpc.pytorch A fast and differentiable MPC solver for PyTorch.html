<!DOCTYPE html>
<html data-darkreader-mode="dynamic" data-darkreader-scheme="dark"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><style class="darkreader darkreader--fallback" media="screen"></style><style class="darkreader darkreader--text" media="screen"></style><style class="darkreader darkreader--invert" media="screen">.jfk-bubble.gtx-bubble, .captcheck_answer_label > input + img, span#closed_text > img[src^="https://www.gstatic.com/images/branding/googlelogo"], span[data-href^="https://www.hcaptcha.com/"] > #icon, #bit-notification-bar-iframe, ::-webkit-calendar-picker-indicator {
    filter: invert(100%) hue-rotate(180deg) contrast(90%) sepia(50%) !important;
}</style><style class="darkreader darkreader--inline" media="screen">[data-darkreader-inline-bgcolor] {
  background-color: var(--darkreader-inline-bgcolor) !important;
}
[data-darkreader-inline-bgimage] {
  background-image: var(--darkreader-inline-bgimage) !important;
}
[data-darkreader-inline-border] {
  border-color: var(--darkreader-inline-border) !important;
}
[data-darkreader-inline-border-bottom] {
  border-bottom-color: var(--darkreader-inline-border-bottom) !important;
}
[data-darkreader-inline-border-left] {
  border-left-color: var(--darkreader-inline-border-left) !important;
}
[data-darkreader-inline-border-right] {
  border-right-color: var(--darkreader-inline-border-right) !important;
}
[data-darkreader-inline-border-top] {
  border-top-color: var(--darkreader-inline-border-top) !important;
}
[data-darkreader-inline-boxshadow] {
  box-shadow: var(--darkreader-inline-boxshadow) !important;
}
[data-darkreader-inline-color] {
  color: var(--darkreader-inline-color) !important;
}
[data-darkreader-inline-fill] {
  fill: var(--darkreader-inline-fill) !important;
}
[data-darkreader-inline-stroke] {
  stroke: var(--darkreader-inline-stroke) !important;
}
[data-darkreader-inline-outline] {
  outline-color: var(--darkreader-inline-outline) !important;
}
[data-darkreader-inline-stopcolor] {
  stop-color: var(--darkreader-inline-stopcolor) !important;
}</style><style class="darkreader darkreader--variables" media="screen">:root {
   --darkreader-neutral-background: #171715;
   --darkreader-neutral-text: #fceacb;
   --darkreader-selection-background: #2e4f75;
   --darkreader-selection-text: #fffddd;
}</style><style class="darkreader darkreader--root-vars" media="screen"></style><style class="darkreader darkreader--user-agent" media="screen">html {
    background-color: #1d1c19 !important;
}
html {
    color-scheme: dark !important;
}
html, body, input, textarea, select, button, dialog {
    background-color: #1d1c19;
}
html, body, input, textarea, select, button {
    border-color: #827661;
    color: #fffddd;
}
a {
    color: #7399be;
}
table {
    border-color: #666359;
}
::placeholder {
    color: #cdbda1;
}
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
    background-color: #47441b !important;
    color: #fffddd !important;
}
::-webkit-scrollbar {
    background-color: #272622;
    color: #c5b59a;
}
::-webkit-scrollbar-thumb {
    background-color: #545149;
}
::-webkit-scrollbar-thumb:hover {
    background-color: #6a675c;
}
::-webkit-scrollbar-thumb:active {
    background-color: #58554c;
}
::-webkit-scrollbar-corner {
    background-color: #1d1c19;
}
* {
    scrollbar-color: #545149 #272622;
}
::selection {
    background-color: #2e4f75 !important;
    color: #fffddd !important;
}
::-moz-selection {
    background-color: #2e4f75 !important;
    color: #fffddd !important;
}</style>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>mpc.pytorch: A fast and differentiable MPC solver for PyTorch</title>

    <link rel="stylesheet" href="mpc.pytorch%20A%20fast%20and%20differentiable%20MPC%20solver%20for%20PyTorch_files/styles.css"><style class="darkreader darkreader--cors" media="screen">body {
  padding:10px 50px 0 0;
  font-family: 'Open Sans', sans-serif;
  font-size: 14px;
  color: #232323;
  background-color: #FBFAF7;
  margin: 0;
  line-height: 1.5rem;
  -webkit-font-smoothing: antialiased;
}

h1, h2, h3, h4, h5, h6 {
    color:#4A66AC;
  margin:36px 0 10px;
}

p, ul, ol, table, dl {
  margin:0 0 22px;
}

h1, h2, h3 {
  font-family: 'PT Serif', serif;
  line-height:1.3;
  font-weight: normal;
  display: block;
  border-bottom: 1px solid #ccc;
  padding-bottom: 5px;
}

h1 {
  font-size: 30px;
}

h2 {
  font-size: 24px;
}

h3 {
  font-size: 18px;
}

h4, h5, h6 {
  font-family: 'PT Serif', serif;
  font-weight: 700;
}

a {
    color:#4A66AC;
  text-decoration:none;
}

a:hover {
  text-decoration: underline;
}

a small {
  font-size: 12px;
}

em {
  font-style: italic;
}

strong {
  font-weight:700;
}

ul {
  padding-left: 25px;
}

ol {
  list-style: decimal;
  padding-left: 20px;
}

blockquote {
  margin: 0;
  padding: 0 0 0 20px;
  font-style: italic;
}

dl, dt, dd, dl p {
  font-color: #444;
}

dl dt {
  font-weight: bold;
}

dl dd {
  padding-left: 20px;
  font-style: italic;
}

dl p {
  padding-left: 20px;
  font-style: italic;
}

hr {
  border:0;
  background:#ccc;
  height:1px;
  margin:0 0 24px;
}



img {
  position: relative;
  margin: 0 auto;
  max-width: 650px;
  padding: 5px;
  margin: 10px 0 32px 0;
  border: 1px solid #ccc;
}

p img {
  display: inline;
  margin: 0;
  padding: 0;
  vertical-align: middle;
  text-align: center;
  border: none;
}


code, pre {
  font-family: monospace;
  color:#000;
  font-size:12px;
  line-height: 14px;
}

pre {
  padding: 6px 12px;
  background: #FDFEFB;
  border-radius:4px;
  border:1px solid #D7D8C8;
  overflow: auto;
  white-space: pre-wrap;
  margin-bottom: 16px;
}



table {
  width:100%;
}

table {
  border: 1px solid #ccc;
  margin-bottom: 32px;
  text-align: left;
 }

th {
  font-family: 'Open Sans', sans-serif;
  font-size: 18px;
  font-weight: normal;
  padding: 10px;
  background: #232323;
  color: #FDFEFB;
 }

td {
  padding: 10px;
  background: #ccc;
 }



.wrapper {
  width:960px;
}




header {
  width:170px;
  float:left;
  position:fixed;
  padding: 12px 25px 22px 50px;
  margin: 24px 25px 0 0;
}

p.header {
  font-size: 14px;
}

h1.header {
  font-size: 30px;
  font-weight: 300;
  line-height: 1.3em;
  margin-top: 0;
}

a.name {
  white-space: nowrap;
}

header ul {
  list-style:none;
  padding:0;
}

header li {
  list-style-type: none;
  width:132px;
  height:15px;
  margin-bottom: 12px;
  line-height: 1em;
  padding: 6px 6px 6px 7px;
  background: #4A66AC;
  border-radius:4px;
  border:1px solid #555;
}





a.buttons {
  color: #fff;
  text-decoration: none;
  font-weight: normal;
  padding: 2px 2px 2px 22px;
  height: 30px;
}

a.github {
  background: url('https://locuslab.github.io/qpth/images/GitHub-Mark-64px.png') no-repeat center left;
  background-size: 15%;
}



section {
  width:650px;
  float:right;
  padding-bottom:50px;
}

p.footnote {
  font-size: 12px;
}




footer {
  width:170px;
  float:left;
  position:fixed;
  bottom:10px;
  padding-left: 50px;
}

@media print, screen and (max-width: 960px) {

  div.wrapper {
    width:auto;
    margin:0;
  }

  header, section, footer {
    float:none;
    position:static;
    width:auto;
  }

  footer {
    border-top: 1px solid #ccc;
    margin:0 84px 0 50px;
    padding:0;
  }
 
  header {
    padding-right:320px;
  }

  section {
    padding:20px 84px 20px 50px;
    margin:0 0 20px;
  }

  header a small {
    display:inline;
  }

  header ul {
    position:absolute;
    right:130px;
    top:84px;
  }
}

@media print, screen and (max-width: 720px) {
  body {
    word-wrap:break-word;
  }

  header {
    padding:10px 20px 0;
    margin-right: 0;
  }

  section {
    padding:10px 0 10px 20px;
    margin:0 0 30px;
  }

  footer {
    margin: 0 0 0 30px;
  }

  header ul, header p.view {
    position:static;
  }
}

@media print, screen and (max-width: 480px) {

  header ul li.download {
    display:none;
  }

  footer {
    margin: 0 0 0 20px;
  }

  footer a{
    display:block;
  }

}

@media print {
  body {
    padding:0.4in;
    font-size:12pt;
    color:#444;
  }
}</style><style class="darkreader darkreader--sync" media="screen"></style>
    <link rel="stylesheet" href="mpc.pytorch%20A%20fast%20and%20differentiable%20MPC%20solver%20for%20PyTorch_files/syntax.css"><style class="darkreader darkreader--sync" media="screen"></style>
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  <meta name="darkreader" content="890fa90a5ce344e7b7805afa700cd1c3"><style class="darkreader darkreader--override" media="screen">.vimvixen-hint {
    background-color: #745a1b !important;
    border-color: #dcbc57 !important;
    color: #ffffd0 !important;
}
#vimvixen-console-frame {
    color-scheme: light !important
}
::placeholder {
    opacity: 0.5 !important;
}
#edge-translate-panel-body,
.MuiTypography-body1,
.nfe-quote-text {
    color: var(--darkreader-neutral-text) !important;
}
gr-main-header {
    background-color: #283a3a !important;
}
.tou-z65h9k,
.tou-mignzq,
.tou-1b6i2ox,
.tou-lnqlqk {
    background-color: var(--darkreader-neutral-background) !important;
}
.tou-75mvi {
    background-color: #121f20 !important;
}
.tou-ta9e87,
.tou-1w3fhi0,
.tou-1b8t2us,
.tou-py7lfi,
.tou-1lpmd9d,
.tou-1frrtv8,
.tou-17ezmgn {
    background-color: #0b0b09 !important;
}
.tou-uknfeu {
    background-color: #21190c !important;
}
.tou-6i3zyv {
    background-color: #3d5758 !important;
}
div.mermaid-viewer-control-panel .btn {
  fill: var(--darkreader-neutral-text);
  background-color: var(--darkreader-neutral-background);
}
svg g rect.er {
  fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.entityBox {
  fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxOdd {
  fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxEven {
  fill-opacity: 0.8 !important;
  fill: var(--darkreader-selection-background);
}
svg rect.er.relationshipLabelBox {
  fill: var(--darkreader-neutral-background) !important;
}
svg g g.nodes rect, svg g g.nodes polygon {
  fill: var(--darkreader-neutral-background) !important;
}
svg g rect.task {
  fill: var(--darkreader-selection-background) !important;
}
svg line.messageLine0, svg line.messageLine1 {
  stroke: var(--darkreader-neutral-text) !important;
}
div.mermaid .actor {
  fill: var(--darkreader-neutral-background) !important;
}
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }</style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style class="darkreader darkreader--sync" media="screen"></style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Blank; src: url('about:blank')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style class="darkreader darkreader--sync" media="screen"></style></head>
  <body data-new-gr-c-s-check-loaded="8.908.0" data-gr-ext-installed=""><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; --darkreader-inline-border-top: currentcolor; --darkreader-inline-border-right: currentcolor; --darkreader-inline-border-bottom: currentcolor; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
    <div class="wrapper">
      <header>
        <h1><a href="https://github.com/locuslab/mpc.pytorch">mpc.pytorch</a></h1>
        <p>A fast and differentiable model predictive control (MPC)
solver for PyTorch.
Crafted by <a href="https://bamos.github.io/">Brandon Amos</a>,
Ivan Jimenez,
Jacob Sacks,
<a href="https://www.cc.gatech.edu/~bboots3/">Byron Boots</a>,
and
<a href="https://zicokolter.com/">J. Zico Kolter</a>.
For more context and details, see our
<a href="https://arxiv.org/abs/1703.00443">ICML 2017 paper on OptNet</a>
and our <a href="https://arxiv.org/abs/1810.13400">NIPS 2018 paper on differentiable MPC</a>.
</p>

        <ul>
            <li>
                <a class="buttons github" href="https://github.com/locuslab/mpc.pytorch">
                    View On GitHub
                </a>
            </li>
        </ul>
      </header>

      <section>
      <h1 id="control-is-important">Control is important!</h1>

<p><img src="mpc.pytorch%20A%20fast%20and%20differentiable%20MPC%20solver%20for%20PyTorch_files/mpc.png" alt=""></p>

<p><a href="https://en.wikipedia.org/wiki/Control_theory">Optimal control</a>
is a widespread field that involve finding an optimal sequence of
future actions to take in a system or environment.
This is the most useful in domains when you can analytically
model your system and can easily define a cost to optimize
over your system.
This project focuses on solving
<a href="https://en.wikipedia.org/wiki/Model_predictive_control">model predictive control</a>
(MPC)
with the
<a href="https://homes.cs.washington.edu/~todorov/papers/TassaICRA14.pdf">box-DDP</a>
heuristic.
MPC is a powerhouse in many real-world domains ranging from
short-time horizon robot control tasks
to long-time horizon control of chemical processing plants.
More recently, the reinforcement learning community,
<a href="http://www.argmin.net/2018/06/25/outsider-rl/">strife with poor sample-complexity and instability issues
in model-free learning</a>,
<a href="https://arxiv.org/pdf/1609.09001.pdf">has</a>
<a href="https://arxiv.org/pdf/1708.02596.pdf">been</a>
<a href="https://arxiv.org/pdf/1802.09081.pdf">actively</a>
<a href="https://arxiv.org/pdf/1804.00645.pdf">searching</a>
<a href="http://papers.nips.cc/paper/6046-value-iteration-networks.pdf">for</a>
<a href="http://papers.nips.cc/paper/7192-value-prediction-network.pdf">useful</a>
<a href="http://papersdb.cs.ualberta.ca/~papersdb/uploaded_files/505/paper_sutton-90.pdf">model-based</a>
<a href="https://arxiv.org/pdf/1707.06203.pdf">applications</a>
<a href="https://arxiv.org/pdf/1707.06170.pdf">and</a>
<a href="https://arxiv.org/abs/1710.11417">priors.</a></p>

<p>Going deeper, model predictive control (MPC) is the strategy of
controlling a system by repeatedly solving a model-based
optimization problem in a receding horizon fashion.
At each time step in the environment,
MPC solves the <em>non-convex</em> optimization problem</p>

<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;g&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;m&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;X&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;U&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;b&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;j&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;/mrow&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 23.736em; display: inline-block;"><span style="display: inline-block; position: relative; width: 19.124em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(-0.917em, 1018.91em, 5.141em, -1000em); top: -2.362em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mtable" id="MathJax-Span-3" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 18.816em; height: 0px;"><span style="position: absolute; clip: rect(3.237em, 1012.9em, 8.109em, -1000em); top: -5.53em; left: 0em;"><span style="display: inline-block; position: relative; width: 12.898em; height: 0px;"><span style="position: absolute; clip: rect(3.026em, 1012.9em, 4.512em, -1000em); top: -5.319em; right: 0em;"><span class="mtd" id="MathJax-Span-4"><span class="mrow" id="MathJax-Span-5"><span class="msubsup" id="MathJax-Span-6"><span style="display: inline-block; position: relative; width: 1.517em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-7" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.38em, 1000.57em, 4.157em, -1000em); top: -4.328em; left: 0.498em;"><span class="mo" id="MathJax-Span-8" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1001.07em, 4.155em, -1000em); top: -3.661em; left: 0.444em;"><span class="texatom" id="MathJax-Span-9"><span class="mrow" id="MathJax-Span-10"><span class="mn" id="MathJax-Span-11" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-12" style="font-size: 70.7%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-13" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-14" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-15" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.573em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-16" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.38em, 1000.57em, 4.157em, -1000em); top: -4.328em; left: 0.5em;"><span class="mo" id="MathJax-Span-17" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1001.07em, 4.155em, -1000em); top: -3.661em; left: 0.5em;"><span class="texatom" id="MathJax-Span-18"><span class="mrow" id="MathJax-Span-19"><span class="mn" id="MathJax-Span-20" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-21" style="font-size: 70.7%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-22" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-23" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-24" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 7.434em; height: 0px;"><span style="position: absolute; clip: rect(3.119em, 1002.82em, 4.365em, -1000em); top: -3.975em; left: 0em;"><span class="texatom" id="MathJax-Span-25"><span class="mrow" id="MathJax-Span-26"><span class="mi" id="MathJax-Span-27" style="font-family: STIXGeneral;">a</span><span class="mi" id="MathJax-Span-28" style="font-family: STIXGeneral;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-29" style="font-family: STIXGeneral;">g</span><span class="mi" id="MathJax-Span-30" style="font-family: STIXGeneral;">m</span><span class="mi" id="MathJax-Span-31" style="font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-32" style="font-family: STIXGeneral;">n</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.721em; left: 2.835em;"><span class="texatom" id="MathJax-Span-33"><span class="mrow" id="MathJax-Span-34"><span class="msubsup" id="MathJax-Span-35"><span style="display: inline-block; position: relative; width: 1.072em; height: 0px;"><span style="position: absolute; clip: rect(3.49em, 1000.32em, 4.155em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-36" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.869em; left: 0.314em;"><span class="texatom" id="MathJax-Span-37"><span class="mrow" id="MathJax-Span-38"><span class="mn" id="MathJax-Span-39" style="font-size: 50%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-40" style="font-size: 50%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-41" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.038em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-42" style="font-size: 70.7%; font-family: STIXGeneral;">∈</span><span class="texatom" id="MathJax-Span-43"><span class="mrow" id="MathJax-Span-44"><span class="mi" id="MathJax-Span-45" style="font-size: 70.7%; font-family: STIXNonUnicode; font-style: italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.033em;"></span></span></span></span><span class="mo" id="MathJax-Span-46" style="font-size: 70.7%; font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-47"><span style="display: inline-block; position: relative; width: 1.112em; height: 0px;"><span style="position: absolute; clip: rect(3.49em, 1000.34em, 4.155em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-48" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.869em; left: 0.354em;"><span class="texatom" id="MathJax-Span-49"><span class="mrow" id="MathJax-Span-50"><span class="mn" id="MathJax-Span-51" style="font-size: 50%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-52" style="font-size: 50%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-53" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.038em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-54" style="font-size: 70.7%; font-family: STIXGeneral;">∈</span><span class="texatom" id="MathJax-Span-55"><span class="mrow" id="MathJax-Span-56"><span class="mi" id="MathJax-Span-57" style="font-size: 70.7%; font-family: STIXNonUnicode; font-style: italic; text-rendering: optimizelegibility;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.094em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mspace" id="MathJax-Span-58" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-59" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.119em, 1005.18em, 4.365em, -1000em); top: -2.924em; right: 0em;"><span class="mtd" id="MathJax-Span-83"><span class="mrow" id="MathJax-Span-84"><span class="mspace" id="MathJax-Span-85" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-86" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="texatom" id="MathJax-Span-87"><span class="mrow" id="MathJax-Span-88"><span class="mi" id="MathJax-Span-89" style="font-family: STIXGeneral;">s</span><span class="mi" id="MathJax-Span-90" style="font-family: STIXGeneral;">u</span><span class="mi" id="MathJax-Span-91" style="font-family: STIXGeneral;">b</span><span class="mi" id="MathJax-Span-92" style="font-family: STIXGeneral;">j</span><span class="mi" id="MathJax-Span-93" style="font-family: STIXGeneral;">e</span><span class="mi" id="MathJax-Span-94" style="font-family: STIXGeneral;">c</span><span class="mi" id="MathJax-Span-95" style="font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mspace" id="MathJax-Span-96" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-97" style="font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mi" id="MathJax-Span-98" style="font-family: STIXGeneral;">o</span></span></span><span class="mspace" id="MathJax-Span-99" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-100" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.802em, 1000em, 4.147em, -1000em); top: -1.568em; right: 0em;"><span class="mtd" id="MathJax-Span-121"><span class="mrow" id="MathJax-Span-122"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.53em;"></span></span><span style="position: absolute; clip: rect(3.403em, 1005.87em, 9.418em, -1000em); top: -6.682em; left: 12.898em;"><span style="display: inline-block; position: relative; width: 5.918em; height: 0px;"><span style="position: absolute; clip: rect(2.098em, 1005.19em, 5.463em, -1000em); top: -5.377em; left: 0em;"><span class="mtd" id="MathJax-Span-60"><span class="mrow" id="MathJax-Span-61"><span class="mi" id="MathJax-Span-62"></span><span class="munderover" id="MathJax-Span-63" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px;"><span style="position: absolute; clip: rect(2.827em, 1001.2em, 4.622em, -1000em); top: -3.975em; left: 0em;"><span class="mo" id="MathJax-Span-64" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1000.97em, 4.255em, -1000em); top: -2.825em; left: 0.122em;"><span class="texatom" id="MathJax-Span-65"><span class="mrow" id="MathJax-Span-66"><span class="mi" id="MathJax-Span-67" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-68" style="font-size: 70.7%; font-family: STIXGeneral;">=</span><span class="mn" id="MathJax-Span-69" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.24em, 1000.45em, 4.147em, -1000em); top: -5.175em; left: 0.422em;"><span class="mi" id="MathJax-Span-70" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-71" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.951em; height: 0px;"><span style="position: absolute; clip: rect(3.136em, 1000.69em, 4.165em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-72" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.667em;"><span class="mi" id="MathJax-Span-73" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-74" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-75"><span style="display: inline-block; position: relative; width: 0.728em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-76" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mi" id="MathJax-Span-77" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-78" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-79" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-80" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-81" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-82" style="font-family: STIXGeneral;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.032em;"></span></span><span style="position: absolute; clip: rect(3.124em, 1005.87em, 4.354em, -1000em); top: -2.924em; left: 0em;"><span class="mtd" id="MathJax-Span-101"><span class="mrow" id="MathJax-Span-102"><span class="msubsup" id="MathJax-Span-103"><span style="display: inline-block; position: relative; width: 1.566em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-104" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="texatom" id="MathJax-Span-105"><span class="mrow" id="MathJax-Span-106"><span class="mi" id="MathJax-Span-107" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-108" style="font-size: 70.7%; font-family: STIXGeneral;">+</span><span class="mn" id="MathJax-Span-109" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-110" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-111" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mo" id="MathJax-Span-112" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-113"><span style="display: inline-block; position: relative; width: 0.728em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-114" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mi" id="MathJax-Span-115" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-116" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-117" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-118" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-119" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-120" style="font-family: STIXGeneral;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.361em, 1003.84em, 4.305em, -1000em); top: -1.568em; left: 0em;"><span class="mtd" id="MathJax-Span-123"><span class="mrow" id="MathJax-Span-124"><span class="msubsup" id="MathJax-Span-125"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-126" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mn" id="MathJax-Span-127" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-128" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-129" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.463em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-130" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="texatom" id="MathJax-Span-131"><span class="mrow" id="MathJax-Span-132"><span class="mi" id="MathJax-Span-133" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-134" style="font-size: 70.7%; font-family: STIXGeneral;">n</span><span class="mi" id="MathJax-Span-135" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-136" style="font-size: 70.7%; font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-137" style="font-family: STIXGeneral;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.682em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.362em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -3.303em; border-left: 0px solid; width: 0px; height: 7.226em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left" rowspacing="3pt" columnspacing="0em" displaystyle="true"><mtr><mtd><msubsup><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow><mo>⋆</mo></msubsup><mo>,</mo><msubsup><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow><mo>⋆</mo></msubsup><mo>=</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow></msub><mo>∈</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">X</mi></mrow><mo>,</mo><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow></msub><mo>∈</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">U</mi></mrow></mrow></msub><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace></mtd><mtd><mi></mi><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>T</mi></munderover><msub><mi>C</mi><mi>t</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>,</mo><msub><mi>u</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">s</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">j</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mspace width="thickmathspace"></mspace><mi mathvariant="normal">t</mi><mi mathvariant="normal">o</mi></mrow><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace></mtd><mtd><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>,</mo><msub><mi>u</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd></mtd><mtd><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow></msub><mo>,</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">% <![CDATA[
\begin{equation}
\begin{split}
    x_{1:T}^\star, u_{1:T}^\star = {\rm argmin}_{x_{1:T} \in \mathcal{X},u_{1:T}\in \mathcal{U}} \;\; & \sum_{t=1}^T C_t(x_t, u_t)  \\
    \;\; {\rm subject\; to} \;\; & x_{t+1} = f(x_t, u_t) \\
    & x_1 = x_{\rm init},
\end{split}
\end{equation} %]]></script>

<p>where <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-138" style="width: 2.422em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.959em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.921em, 1001.96em, 2.865em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-139"><span class="msubsup" id="MathJax-Span-140"><span style="display: inline-block; position: relative; width: 0.728em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-141" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mi" id="MathJax-Span-142" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-143" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-144" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-145" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-146" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.267em; border-left: 0px solid; width: 0px; height: 0.885em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mi>t</mi></msub><mo>,</mo><msub><mi>u</mi><mi>t</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-2">x_t, u_t</script> denote the state and control at time <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-147" style="width: 0.406em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.288em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.816em, 1000.29em, 2.718em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-148"><span class="mi" id="MathJax-Span-149" style="font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.018em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 0.834em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">t</script>, <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;X&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-150" style="width: 0.925em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.749em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(2.208em, 1000.75em, 3.239em, -1000em); top: -3.053em; left: 0em;"><span class="mrow" id="MathJax-Span-151"><span class="texatom" id="MathJax-Span-152"><span class="mrow" id="MathJax-Span-153"><span class="mi" id="MathJax-Span-154" style="font-family: STIXNonUnicode; font-style: italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.053em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.088em; border-left: 0px solid; width: 0px; height: 0.992em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">X</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-4">\mathcal{X}</script> and
<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;U&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-155" style="width: 1.213em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.979em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(2.208em, 1000.98em, 3.239em, -1000em); top: -3.053em; left: 0em;"><span class="mrow" id="MathJax-Span-156"><span class="texatom" id="MathJax-Span-157"><span class="mrow" id="MathJax-Span-158"><span class="mi" id="MathJax-Span-159" style="font-family: STIXNonUnicode; font-style: italic; text-rendering: optimizelegibility;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.133em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.053em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.088em; border-left: 0px solid; width: 0px; height: 0.992em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">U</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-5">\mathcal{U}</script> denote constraints on valid states and controls, <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;X&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;U&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-160" style="width: 8.643em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.97em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(2.208em, 1006.94em, 3.384em, -1000em); top: -3.053em; left: 0em;"><span class="mrow" id="MathJax-Span-161"><span class="msubsup" id="MathJax-Span-162"><span style="display: inline-block; position: relative; width: 0.951em; height: 0px;"><span style="position: absolute; clip: rect(3.136em, 1000.69em, 4.165em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-163" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.667em;"><span class="mi" id="MathJax-Span-164" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-165" style="font-family: STIXGeneral; padding-left: 0.313em;">:</span><span class="texatom" id="MathJax-Span-166" style="padding-left: 0.313em;"><span class="mrow" id="MathJax-Span-167"><span class="mi" id="MathJax-Span-168" style="font-family: STIXNonUnicode; font-style: italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span></span></span><span class="mo" id="MathJax-Span-169" style="font-family: STIXGeneral; padding-left: 0.25em;">×</span><span class="texatom" id="MathJax-Span-170" style="padding-left: 0.25em;"><span class="mrow" id="MathJax-Span-171"><span class="mi" id="MathJax-Span-172" style="font-family: STIXNonUnicode; font-style: italic; text-rendering: optimizelegibility;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.133em;"></span></span></span></span><span class="mo" id="MathJax-Span-173" style="font-family: STIXGeneral; padding-left: 0.313em;">→</span><span class="texatom" id="MathJax-Span-174" style="padding-left: 0.313em;"><span class="mrow" id="MathJax-Span-175"><span class="mi" id="MathJax-Span-176" style="font-family: STIXGeneral;">ℝ</span></span></span></span><span style="display: inline-block; width: 0px; height: 3.053em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.267em; border-left: 0px solid; width: 0px; height: 1.172em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>C</mi><mi>t</mi></msub><mo>:</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">X</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">U</mi></mrow><mo stretchy="false">→</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-6">C_t : \mathcal{X}
\times \mathcal{U} \rightarrow \mathbb{R}</script> is a (potentially time-varying) cost
function, <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;X&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;U&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;X&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-177" style="width: 8.01em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.452em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(2.202em, 1006.45em, 3.433em, -1000em); top: -3.053em; left: 0em;"><span class="mrow" id="MathJax-Span-178"><span class="mi" id="MathJax-Span-179" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mo" id="MathJax-Span-180" style="font-family: STIXGeneral; padding-left: 0.313em;">:</span><span class="texatom" id="MathJax-Span-181" style="padding-left: 0.313em;"><span class="mrow" id="MathJax-Span-182"><span class="mi" id="MathJax-Span-183" style="font-family: STIXNonUnicode; font-style: italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span></span></span><span class="mo" id="MathJax-Span-184" style="font-family: STIXGeneral; padding-left: 0.25em;">×</span><span class="texatom" id="MathJax-Span-185" style="padding-left: 0.25em;"><span class="mrow" id="MathJax-Span-186"><span class="mi" id="MathJax-Span-187" style="font-family: STIXNonUnicode; font-style: italic; text-rendering: optimizelegibility;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.133em;"></span></span></span></span><span class="mo" id="MathJax-Span-188" style="font-family: STIXGeneral; padding-left: 0.313em;">→</span><span class="texatom" id="MathJax-Span-189" style="padding-left: 0.313em;"><span class="mrow" id="MathJax-Span-190"><span class="mi" id="MathJax-Span-191" style="font-family: STIXNonUnicode; font-style: italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.047em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.053em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.328em; border-left: 0px solid; width: 0px; height: 1.24em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo>:</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">X</mi></mrow><mo>×</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">U</mi></mrow><mo stretchy="false">→</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">X</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-7">f : \mathcal{X} 
\times \mathcal{U} \rightarrow \mathcal{X}</script> is a (potentially non-linear) dynamics model, and
<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-192" style="width: 1.789em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.44em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.748em, 1001.44em, 2.692em, -1000em); top: -2.362em; left: 0em;"><span class="mrow" id="MathJax-Span-193"><span class="msubsup" id="MathJax-Span-194"><span style="display: inline-block; position: relative; width: 1.463em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-195" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="texatom" id="MathJax-Span-196"><span class="mrow" id="MathJax-Span-197"><span class="mi" id="MathJax-Span-198" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-199" style="font-size: 70.7%; font-family: STIXGeneral;">n</span><span class="mi" id="MathJax-Span-200" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-201" style="font-size: 70.7%; font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.362em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.266em; border-left: 0px solid; width: 0px; height: 0.884em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-8">x_{\rm init}</script> denotes the initial state of the system.
After solving this
problem, we execute the first returned control <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-202" style="width: 1.155em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.922em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.748em, 1000.92em, 2.685em, -1000em); top: -2.362em; left: 0em;"><span class="mrow" id="MathJax-Span-203"><span class="msubsup" id="MathJax-Span-204"><span style="display: inline-block; position: relative; width: 0.929em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-205" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mn" id="MathJax-Span-206" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.362em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.257em; border-left: 0px solid; width: 0px; height: 0.876em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mn>1</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-9">u_1</script>, on the real system, step
forward in time, and repeat the process.
The MPC optimization problem can be efficiently solved with a number
of methods, for example the finite-horizon
<a href="https://en.wikipedia.org/wiki/Linear%E2%80%93quadratic_regulator">iterative Linear Quadratic Regulator (iLQR)</a>
algorithm.
We focus on the
<a href="https://homes.cs.washington.edu/~todorov/papers/TassaICRA14.pdf">box-DDP</a>
heuristic which adds control bounds to the problem.</p>

<h1 id="control-in-pytorch-has-been-painful-before-now">Control in PyTorch has been painful before now</h1>

<p>There has been an indisputable rise in control and model-based
algorithms in the learning communities lately and integrating
these techniques with learning-based methods is important.
<a href="http://pytorch.org/">PyTorch</a> is a strong foundational
Python library for implementing and coding learning systems.
Before our library, there was a significant barrier
to integrating PyTorch learning systems with control
methods.
The appropriate data and tensors would have to be transferred
to the CPU, converted to numpy, and then passed into
1) one of the few Python control libraries, like
<a href="https://python-control.readthedocs.io/en/latest/">python-control</a>,
2) a hand-coded solver using CPLEX or Gurobi, or
3) your hand-rolled bindings to C/C++/matlab control
libraries such as
<a href="https://web.stanford.edu/~boyd/fast_mpc/">fast_mpc</a>.
<em>All of these sound like fun!</em></p>

<h1 id="this-library-a-differentiable-pytorch-mpc-layer">This Library: A Differentiable PyTorch MPC Layer</h1>

<p>We provide a PyTorch library for solving the non-convex
control problem</p>

<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;g&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;m&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;X&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;U&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;b&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;j&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;/mrow&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-207" style="width: 23.736em; display: inline-block;"><span style="display: inline-block; position: relative; width: 19.124em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(-0.917em, 1018.91em, 5.141em, -1000em); top: -2.362em; left: 0em;"><span class="mrow" id="MathJax-Span-208"><span class="mtable" id="MathJax-Span-209" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 18.816em; height: 0px;"><span style="position: absolute; clip: rect(3.237em, 1012.9em, 8.109em, -1000em); top: -5.53em; left: 0em;"><span style="display: inline-block; position: relative; width: 12.898em; height: 0px;"><span style="position: absolute; clip: rect(3.026em, 1012.9em, 4.512em, -1000em); top: -5.319em; right: 0em;"><span class="mtd" id="MathJax-Span-210"><span class="mrow" id="MathJax-Span-211"><span class="msubsup" id="MathJax-Span-212"><span style="display: inline-block; position: relative; width: 1.517em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-213" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.38em, 1000.57em, 4.157em, -1000em); top: -4.328em; left: 0.498em;"><span class="mo" id="MathJax-Span-214" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1001.07em, 4.155em, -1000em); top: -3.661em; left: 0.444em;"><span class="texatom" id="MathJax-Span-215"><span class="mrow" id="MathJax-Span-216"><span class="mn" id="MathJax-Span-217" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-218" style="font-size: 70.7%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-219" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-220" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-221" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.573em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-222" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.38em, 1000.57em, 4.157em, -1000em); top: -4.328em; left: 0.5em;"><span class="mo" id="MathJax-Span-223" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1001.07em, 4.155em, -1000em); top: -3.661em; left: 0.5em;"><span class="texatom" id="MathJax-Span-224"><span class="mrow" id="MathJax-Span-225"><span class="mn" id="MathJax-Span-226" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-227" style="font-size: 70.7%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-228" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-229" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-230" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 7.434em; height: 0px;"><span style="position: absolute; clip: rect(3.119em, 1002.82em, 4.365em, -1000em); top: -3.975em; left: 0em;"><span class="texatom" id="MathJax-Span-231"><span class="mrow" id="MathJax-Span-232"><span class="mi" id="MathJax-Span-233" style="font-family: STIXGeneral;">a</span><span class="mi" id="MathJax-Span-234" style="font-family: STIXGeneral;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-235" style="font-family: STIXGeneral;">g</span><span class="mi" id="MathJax-Span-236" style="font-family: STIXGeneral;">m</span><span class="mi" id="MathJax-Span-237" style="font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-238" style="font-family: STIXGeneral;">n</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.721em; left: 2.835em;"><span class="texatom" id="MathJax-Span-239"><span class="mrow" id="MathJax-Span-240"><span class="msubsup" id="MathJax-Span-241"><span style="display: inline-block; position: relative; width: 1.072em; height: 0px;"><span style="position: absolute; clip: rect(3.49em, 1000.32em, 4.155em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-242" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.869em; left: 0.314em;"><span class="texatom" id="MathJax-Span-243"><span class="mrow" id="MathJax-Span-244"><span class="mn" id="MathJax-Span-245" style="font-size: 50%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-246" style="font-size: 50%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-247" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.038em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-248" style="font-size: 70.7%; font-family: STIXGeneral;">∈</span><span class="texatom" id="MathJax-Span-249"><span class="mrow" id="MathJax-Span-250"><span class="mi" id="MathJax-Span-251" style="font-size: 70.7%; font-family: STIXNonUnicode; font-style: italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.033em;"></span></span></span></span><span class="mo" id="MathJax-Span-252" style="font-size: 70.7%; font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-253"><span style="display: inline-block; position: relative; width: 1.112em; height: 0px;"><span style="position: absolute; clip: rect(3.49em, 1000.34em, 4.155em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-254" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.869em; left: 0.354em;"><span class="texatom" id="MathJax-Span-255"><span class="mrow" id="MathJax-Span-256"><span class="mn" id="MathJax-Span-257" style="font-size: 50%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-258" style="font-size: 50%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-259" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.038em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-260" style="font-size: 70.7%; font-family: STIXGeneral;">∈</span><span class="texatom" id="MathJax-Span-261"><span class="mrow" id="MathJax-Span-262"><span class="mi" id="MathJax-Span-263" style="font-size: 70.7%; font-family: STIXNonUnicode; font-style: italic; text-rendering: optimizelegibility;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.094em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mspace" id="MathJax-Span-264" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-265" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.119em, 1005.18em, 4.365em, -1000em); top: -2.924em; right: 0em;"><span class="mtd" id="MathJax-Span-289"><span class="mrow" id="MathJax-Span-290"><span class="mspace" id="MathJax-Span-291" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-292" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="texatom" id="MathJax-Span-293"><span class="mrow" id="MathJax-Span-294"><span class="mi" id="MathJax-Span-295" style="font-family: STIXGeneral;">s</span><span class="mi" id="MathJax-Span-296" style="font-family: STIXGeneral;">u</span><span class="mi" id="MathJax-Span-297" style="font-family: STIXGeneral;">b</span><span class="mi" id="MathJax-Span-298" style="font-family: STIXGeneral;">j</span><span class="mi" id="MathJax-Span-299" style="font-family: STIXGeneral;">e</span><span class="mi" id="MathJax-Span-300" style="font-family: STIXGeneral;">c</span><span class="mi" id="MathJax-Span-301" style="font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mspace" id="MathJax-Span-302" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-303" style="font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mi" id="MathJax-Span-304" style="font-family: STIXGeneral;">o</span></span></span><span class="mspace" id="MathJax-Span-305" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-306" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.802em, 1000em, 4.147em, -1000em); top: -1.568em; right: 0em;"><span class="mtd" id="MathJax-Span-327"><span class="mrow" id="MathJax-Span-328"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.53em;"></span></span><span style="position: absolute; clip: rect(3.403em, 1005.87em, 9.418em, -1000em); top: -6.682em; left: 12.898em;"><span style="display: inline-block; position: relative; width: 5.918em; height: 0px;"><span style="position: absolute; clip: rect(2.098em, 1005.19em, 5.463em, -1000em); top: -5.377em; left: 0em;"><span class="mtd" id="MathJax-Span-266"><span class="mrow" id="MathJax-Span-267"><span class="mi" id="MathJax-Span-268"></span><span class="munderover" id="MathJax-Span-269" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px;"><span style="position: absolute; clip: rect(2.827em, 1001.2em, 4.622em, -1000em); top: -3.975em; left: 0em;"><span class="mo" id="MathJax-Span-270" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1000.97em, 4.255em, -1000em); top: -2.825em; left: 0.122em;"><span class="texatom" id="MathJax-Span-271"><span class="mrow" id="MathJax-Span-272"><span class="mi" id="MathJax-Span-273" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-274" style="font-size: 70.7%; font-family: STIXGeneral;">=</span><span class="mn" id="MathJax-Span-275" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.24em, 1000.45em, 4.147em, -1000em); top: -5.175em; left: 0.422em;"><span class="mi" id="MathJax-Span-276" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-277" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.951em; height: 0px;"><span style="position: absolute; clip: rect(3.136em, 1000.69em, 4.165em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-278" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.667em;"><span class="mi" id="MathJax-Span-279" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-280" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-281"><span style="display: inline-block; position: relative; width: 0.728em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-282" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mi" id="MathJax-Span-283" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-284" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-285" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-286" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-287" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-288" style="font-family: STIXGeneral;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.032em;"></span></span><span style="position: absolute; clip: rect(3.124em, 1005.87em, 4.354em, -1000em); top: -2.924em; left: 0em;"><span class="mtd" id="MathJax-Span-307"><span class="mrow" id="MathJax-Span-308"><span class="msubsup" id="MathJax-Span-309"><span style="display: inline-block; position: relative; width: 1.566em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-310" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="texatom" id="MathJax-Span-311"><span class="mrow" id="MathJax-Span-312"><span class="mi" id="MathJax-Span-313" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-314" style="font-size: 70.7%; font-family: STIXGeneral;">+</span><span class="mn" id="MathJax-Span-315" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-316" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-317" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mo" id="MathJax-Span-318" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-319"><span style="display: inline-block; position: relative; width: 0.728em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-320" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mi" id="MathJax-Span-321" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-322" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-323" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-324" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-325" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-326" style="font-family: STIXGeneral;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.361em, 1003.84em, 4.305em, -1000em); top: -1.568em; left: 0em;"><span class="mtd" id="MathJax-Span-329"><span class="mrow" id="MathJax-Span-330"><span class="msubsup" id="MathJax-Span-331"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-332" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mn" id="MathJax-Span-333" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-334" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-335" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.463em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-336" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="texatom" id="MathJax-Span-337"><span class="mrow" id="MathJax-Span-338"><span class="mi" id="MathJax-Span-339" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-340" style="font-size: 70.7%; font-family: STIXGeneral;">n</span><span class="mi" id="MathJax-Span-341" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-342" style="font-size: 70.7%; font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-343" style="font-family: STIXGeneral;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.682em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.362em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -3.303em; border-left: 0px solid; width: 0px; height: 7.226em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left" rowspacing="3pt" columnspacing="0em" displaystyle="true"><mtr><mtd><msubsup><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow><mo>⋆</mo></msubsup><mo>,</mo><msubsup><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow><mo>⋆</mo></msubsup><mo>=</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow></msub><mo>∈</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">X</mi></mrow><mo>,</mo><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow></msub><mo>∈</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">U</mi></mrow></mrow></msub><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace></mtd><mtd><mi></mi><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>T</mi></munderover><msub><mi>C</mi><mi>t</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>,</mo><msub><mi>u</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">s</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">j</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mspace width="thickmathspace"></mspace><mi mathvariant="normal">t</mi><mi mathvariant="normal">o</mi></mrow><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace></mtd><mtd><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>,</mo><msub><mi>u</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd></mtd><mtd><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow></msub><mo>,</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-10">% <![CDATA[
\begin{equation}
\begin{split}
    x_{1:T}^\star, u_{1:T}^\star = {\rm argmin}_{x_{1:T} \in \mathcal{X},u_{1:T}\in \mathcal{U}} \;\; & \sum_{t=1}^T C_t(x_t, u_t)  \\
    \;\; {\rm subject\; to} \;\; & x_{t+1} = f(x_t, u_t) \\
    & x_1 = x_{\rm init},
\end{split}
\end{equation} %]]></script>

<p>Our code currently supports a quadratic cost function <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-344" style="width: 0.867em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.691em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.696em, 1000.69em, 2.725em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-345"><span class="mi" id="MathJax-Span-346" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.094em; border-left: 0px solid; width: 0px; height: 0.991em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math></span></span><script type="math/tex" id="MathJax-Element-11">C</script>
(non-quadratic support coming soon!) and
non-linear system transition dynamics <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-347" style="width: 0.521em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.403em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.684em, 1000.4em, 2.914em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-348"><span class="mi" id="MathJax-Span-349" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.328em; border-left: 0px solid; width: 0px; height: 1.24em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi></math></span></span><script type="math/tex" id="MathJax-Element-12">f</script> that can
be defined by hand if you understand your environment
or a neural network if you don’t.</p>

<h2 id="our-library-is-fast">Our library is fast</h2>
<p>We have baked in a lot of tricks to optimize the performance.
Our CPU runtime is competitive with other solvers
and our library shines brightly on the GPU as we have
implemented it with efficient GPU-based PyTorch operations.
<em>This lets us solve many MPC problems simultaneously
on the GPU with minimal overhead.</em></p>

<h2 id="internally-we-solve-a-sequence-of-quadratic-programs">Internally we solve a sequence of quadratic programs</h2>
<p>More details on this are in the
<a href="https://homes.cs.washington.edu/~todorov/papers/TassaICRA14.pdf">box-DDP</a>
paper that we implement.</p>

<p><img src="mpc.pytorch%20A%20fast%20and%20differentiable%20MPC%20solver%20for%20PyTorch_files/qp-iters.png" alt=""></p>

<h1 id="differentiable-mpc-as-a-layer">Differentiable MPC as a Layer</h1>

<p><img src="mpc.pytorch%20A%20fast%20and%20differentiable%20MPC%20solver%20for%20PyTorch_files/mpc-layer.png" alt="">
<img src="mpc.pytorch%20A%20fast%20and%20differentiable%20MPC%20solver%20for%20PyTorch_files/mpc-module.png" alt=""></p>

<p>Our MPC layer is also differentiable!
You can do learning directly through it.
The backwards pass is nearly free.
More details on this are in our NIPS 2018 paper
<a href="https://arxiv.org/abs/1810.13400">Differentiable MPC for End-to-end Planning and Control</a>.</p>

<h2 id="differentiable-mpc-and-fixed-points">Differentiable MPC and fixed points</h2>
<p>Sometimes the controller does not run for long enough to reach a
fixed point, or a fixed point doesn’t exist, which often happens when
using neural networks to approximate the dynamics.
When this happens, our solver cannot be used to differentiate
through the controller, because it assumes a fixed point happens.
Differentiating through the final iLQR iterate that’s not
a fixed point will usually give the wrong gradients.
Treating the iLQR procedure as a compute graph and differentiating through
the unrolled operations is a reasonable alternative in this scenario that
obtains surrogate gradients to the control problem, but
this is not currently implemented as an option in this library.</p>

<p>To help catch fixed-point differentiation errors, our
solver has the options <code class="highlighter-rouge">exit_unconverged</code> that forcefully
exits the program if a fixed-point is not hit
(to make sure users are aware of this issue) and
<code class="highlighter-rouge">detach_unconverged</code> that more silently detaches unconverged examples
from the batch so that they are not differentiated through.</p>

<h1 id="setup-and-dependencies">Setup and Dependencies</h1>

<ul>
  <li>Python/numpy/<a href="https://pytorch.org/">PyTorch</a></li>
  <li>You can set this project up manually by cloning the git repo
or you can install it via pip with:</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install mpc
</code></pre></div></div>

<h1 id="dynamics-jacobian-computation-modes">Dynamics Jacobian Computation Modes</h1>

<p>Our approach to MPC requires that the dynamics function
<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-350" style="width: 1.904em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.498em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.684em, 1001.45em, 2.914em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-351"><span class="mi" id="MathJax-Span-352" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mo" id="MathJax-Span-353" style="font-family: STIXGeneral;">(</span><span class="mi" id="MathJax-Span-354" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span class="mo" id="MathJax-Span-355" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.328em; border-left: 0px solid; width: 0px; height: 1.24em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>τ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-13">f(\tau)</script> where <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-356" style="width: 4.15em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.341em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.7em, 1003.25em, 2.863em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-357"><span class="mi" id="MathJax-Span-358" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span class="mo" id="MathJax-Span-359" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="mo" id="MathJax-Span-360" style="font-family: STIXGeneral; padding-left: 0.313em;">[</span><span class="mi" id="MathJax-Span-361" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-362" style="font-family: STIXGeneral; font-style: italic;">u</span><span class="mo" id="MathJax-Span-363" style="font-family: STIXGeneral;">]</span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.265em; border-left: 0px solid; width: 0px; height: 1.157em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>τ</mi><mo>=</mo><mo stretchy="false">[</mo><mi>x</mi><mi>u</mi><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-14">\tau=[x u]</script> is linearized at each time step
around the current iterate <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-364" style="width: 0.867em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.691em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.761em, 1000.69em, 2.692em, -1000em); top: -2.362em; left: 0em;"><span class="mrow" id="MathJax-Span-365"><span class="msubsup" id="MathJax-Span-366"><span style="display: inline-block; position: relative; width: 0.682em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-367" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.41em;"><span class="mi" id="MathJax-Span-368" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.362em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.267em; border-left: 0px solid; width: 0px; height: 0.869em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>τ</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-15">\tau_i</script>
by computing the first-order Taylor expansion as</p>

<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x007E;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-369" style="width: 14.807em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.924em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.434em, 1011.86em, 2.914em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-370"><span class="texatom" id="MathJax-Span-371"><span class="mrow" id="MathJax-Span-372"><span class="munderover" id="MathJax-Span-373"><span style="display: inline-block; position: relative; width: 0.497em; height: 0px;"><span style="position: absolute; clip: rect(3.124em, 1000.42em, 4.354em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-374" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -4.265em; left: 0.167em;"><span style="height: 0em; vertical-align: 0em; width: 0.395em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-375" style="font-family: STIXGeneral;">̃&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.23em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-376" style="font-family: STIXGeneral;">(</span><span class="mi" id="MathJax-Span-377" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span class="mo" id="MathJax-Span-378" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-379" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-380" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mo" id="MathJax-Span-381" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-382"><span style="display: inline-block; position: relative; width: 0.682em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-383" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.41em;"><span class="mi" id="MathJax-Span-384" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-385" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-386" style="font-family: STIXGeneral; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-387" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.107em; height: 0px;"><span style="position: absolute; clip: rect(3.14em, 1000.67em, 4.159em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-388" style="font-family: STIXGeneral;">∇</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.731em;"><span class="mi" id="MathJax-Span-389" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.011em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mi" id="MathJax-Span-390" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mo" id="MathJax-Span-391" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-392"><span style="display: inline-block; position: relative; width: 0.682em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-393" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.41em;"><span class="mi" id="MathJax-Span-394" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-395" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-396" style="font-family: STIXGeneral;">(</span><span class="mi" id="MathJax-Span-397" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span class="mo" id="MathJax-Span-398" style="font-family: STIXGeneral; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-399" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.682em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-400" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.41em;"><span class="mi" id="MathJax-Span-401" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-402" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-403" style="font-family: STIXGeneral;">.</span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.328em; border-left: 0px solid; width: 0px; height: 1.55em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mover><mi>f</mi><mo stretchy="false">~</mo></mover></mrow><mo stretchy="false">(</mo><mi>τ</mi><mo stretchy="false">)</mo><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>τ</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi mathvariant="normal">∇</mi><mi>τ</mi></msub><mi>f</mi><mo stretchy="false">(</mo><msub><mi>τ</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>τ</mi><mo>−</mo><msub><mi>τ</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>.</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-16">\tilde f(\tau) = f(\tau_i) + \nabla_\tau f(\tau_i) (\tau-\tau_i).</script>

<p>Depending on what function you are using to model your dynamics
computing <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-404" style="width: 3.574em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.88em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.684em, 1002.83em, 2.914em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-405"><span class="msubsup" id="MathJax-Span-406"><span style="display: inline-block; position: relative; width: 1.107em; height: 0px;"><span style="position: absolute; clip: rect(3.14em, 1000.67em, 4.159em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-407" style="font-family: STIXGeneral;">∇</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.731em;"><span class="mi" id="MathJax-Span-408" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.011em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mi" id="MathJax-Span-409" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mo" id="MathJax-Span-410" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-411"><span style="display: inline-block; position: relative; width: 0.682em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-412" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.41em;"><span class="mi" id="MathJax-Span-413" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-414" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.328em; border-left: 0px solid; width: 0px; height: 1.24em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi mathvariant="normal">∇</mi><mi>τ</mi></msub><mi>f</mi><mo stretchy="false">(</mo><msub><mi>τ</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-17">\nabla_\tau f(\tau_i)</script> may be easy or difficult
to implement. We provide three options of how our solver
internally computes <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-415" style="width: 3.574em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.88em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.684em, 1002.83em, 2.914em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-416"><span class="msubsup" id="MathJax-Span-417"><span style="display: inline-block; position: relative; width: 1.107em; height: 0px;"><span style="position: absolute; clip: rect(3.14em, 1000.67em, 4.159em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-418" style="font-family: STIXGeneral;">∇</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.731em;"><span class="mi" id="MathJax-Span-419" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.011em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mi" id="MathJax-Span-420" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mo" id="MathJax-Span-421" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-422"><span style="display: inline-block; position: relative; width: 0.682em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-423" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.41em;"><span class="mi" id="MathJax-Span-424" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">i</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-425" style="font-family: STIXGeneral;">)</span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.328em; border-left: 0px solid; width: 0px; height: 1.24em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi mathvariant="normal">∇</mi><mi>τ</mi></msub><mi>f</mi><mo stretchy="false">(</mo><msub><mi>τ</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-18">\nabla_\tau f(\tau_i)</script> that
are passed in to the solver as the <code class="highlighter-rouge">grad_method</code> argument.
<code class="highlighter-rouge">GradMethods</code> is defined in our <code class="highlighter-rouge">mpc</code> module.</p>

<ol>
  <li><code class="highlighter-rouge">GradMethods.ANALYTIC</code>: Use a manually-defined Jacobian.
The is the fastest and most accurate way to compute the Jacobian.
Use this if possible.
<strong>Caveat:</strong> We do not check the Jacobian for correctness
and you will get silent errors if it is incorrect.</li>
  <li><code class="highlighter-rouge">GradMethods.AUTO_DIFF</code>: Use PyTorch’s autograd.
This is a convenient albeit slow option if you implement the
forward pass of your dynamics with PyTorch operations
and want to use PyTorch’s automatic differentiation.</li>
  <li><code class="highlighter-rouge">GradMethods.FINITE_DIFF</code>: Use naive finite differences.
This is convenient if you want to do control in non-PyTorch
environments that don’t give you easy access to the Jacobians,
such as Mujoco/DART/Bullet simulators.
This option may result in inaccurate Jacobians.</li>
</ol>

<h1 id="slew-rate-penalty">Slew Rate Penalty</h1>

<p>You can set the <code class="highlighter-rouge">slew_rate_penalty</code> option in our solver
to add a <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-426" style="width: 0.579em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.461em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.684em, 1000.43em, 2.723em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-427"><span class="mi" id="MathJax-Span-428" style="font-family: STIXGeneral; font-style: italic;">λ</span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.091em; border-left: 0px solid; width: 0px; height: 1.003em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>λ</mi></math></span></span><script type="math/tex" id="MathJax-Element-19">\lambda</script> term to the objective that penalizes the <em>slew rate</em>,
or difference between controls at adjacent timesteps:
<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msubsup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-429" style="width: 7.434em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.991em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.453em, 1005.99em, 3.103em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-430"><span class="mfrac" id="MathJax-Span-431"><span style="display: inline-block; position: relative; width: 0.474em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.322em, 1000.31em, 4.159em, -1000em); top: -4.404em; left: 50%; margin-left: -0.162em;"><span class="mi" id="MathJax-Span-432" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1000.34em, 4.147em, -1000em); top: -3.579em; left: 50%; margin-left: -0.177em;"><span class="mn" id="MathJax-Span-433" style="font-size: 70.7%; font-family: STIXGeneral;">2</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(0.85em, 1000.47em, 1.267em, -1000em); top: -1.314em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.474em; height: 0px; --darkreader-inline-border-top: currentcolor;" data-darkreader-inline-border-top=""></span><span style="display: inline-block; width: 0px; height: 1.094em;"></span></span></span></span><span class="texatom" id="MathJax-Span-434"><span class="mrow" id="MathJax-Span-435"><span class="mo" id="MathJax-Span-436" style="font-family: STIXVariants;">|</span></span></span><span class="texatom" id="MathJax-Span-437"><span class="mrow" id="MathJax-Span-438"><span class="mo" id="MathJax-Span-439" style="font-family: STIXVariants;">|</span></span></span><span class="msubsup" id="MathJax-Span-440"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-441" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-442" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-443" style="font-family: STIXGeneral; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-444" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.622em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-445" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="texatom" id="MathJax-Span-446"><span class="mrow" id="MathJax-Span-447"><span class="mi" id="MathJax-Span-448" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-449" style="font-size: 70.7%; font-family: STIXGeneral;">+</span><span class="mn" id="MathJax-Span-450" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="texatom" id="MathJax-Span-451"><span class="mrow" id="MathJax-Span-452"><span class="mo" id="MathJax-Span-453" style="font-family: STIXVariants;">|</span></span></span><span class="msubsup" id="MathJax-Span-454"><span style="display: inline-block; position: relative; width: 0.749em; height: 0px;"><span style="position: absolute; clip: rect(3.112em, 1000.19em, 4.336em, -1000em); top: -3.975em; left: 0em;"><span class="texatom" id="MathJax-Span-455"><span class="mrow" id="MathJax-Span-456"><span class="mo" id="MathJax-Span-457" style="font-family: STIXVariants;">|</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1000.43em, 4.147em, -1000em); top: -4.392em; left: 0.32em;"><span class="mn" id="MathJax-Span-458" style="font-size: 70.7%; font-family: STIXGeneral;">2</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1000.43em, 4.147em, -1000em); top: -3.727em; left: 0.32em;"><span class="mn" id="MathJax-Span-459" style="font-size: 70.7%; font-family: STIXGeneral;">2</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.562em; border-left: 0px solid; width: 0px; height: 1.761em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mi>λ</mi><mn>2</mn></mfrac><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mi>u</mi><mi>t</mi></msub><mo>−</mo><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msubsup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mn>2</mn><mn>2</mn></msubsup></math></span></span><script type="math/tex" id="MathJax-Element-20">\frac{\lambda}{2}||u_t-u_{t+1}||_2^2</script></p>

<p>This turns the control problem into:</p>

<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;g&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;m&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;X&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;U&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msubsup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;b&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;j&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;/mrow&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-460" style="width: 32.031em; display: inline-block;"><span style="display: inline-block; position: relative; width: 25.806em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(-0.917em, 1025.64em, 5.141em, -1000em); top: -2.362em; left: 0em;"><span class="mrow" id="MathJax-Span-461"><span class="mtable" id="MathJax-Span-462" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 25.479em; height: 0px;"><span style="position: absolute; clip: rect(3.237em, 1012.9em, 8.109em, -1000em); top: -5.53em; left: 0em;"><span style="display: inline-block; position: relative; width: 12.898em; height: 0px;"><span style="position: absolute; clip: rect(3.026em, 1012.9em, 4.512em, -1000em); top: -5.319em; right: 0em;"><span class="mtd" id="MathJax-Span-463"><span class="mrow" id="MathJax-Span-464"><span class="msubsup" id="MathJax-Span-465"><span style="display: inline-block; position: relative; width: 1.517em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-466" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.38em, 1000.57em, 4.157em, -1000em); top: -4.328em; left: 0.498em;"><span class="mo" id="MathJax-Span-467" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1001.07em, 4.155em, -1000em); top: -3.661em; left: 0.444em;"><span class="texatom" id="MathJax-Span-468"><span class="mrow" id="MathJax-Span-469"><span class="mn" id="MathJax-Span-470" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-471" style="font-size: 70.7%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-472" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-473" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-474" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.573em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-475" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.38em, 1000.57em, 4.157em, -1000em); top: -4.328em; left: 0.5em;"><span class="mo" id="MathJax-Span-476" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1001.07em, 4.155em, -1000em); top: -3.661em; left: 0.5em;"><span class="texatom" id="MathJax-Span-477"><span class="mrow" id="MathJax-Span-478"><span class="mn" id="MathJax-Span-479" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-480" style="font-size: 70.7%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-481" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-482" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-483" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 7.434em; height: 0px;"><span style="position: absolute; clip: rect(3.119em, 1002.82em, 4.365em, -1000em); top: -3.975em; left: 0em;"><span class="texatom" id="MathJax-Span-484"><span class="mrow" id="MathJax-Span-485"><span class="mi" id="MathJax-Span-486" style="font-family: STIXGeneral;">a</span><span class="mi" id="MathJax-Span-487" style="font-family: STIXGeneral;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-488" style="font-family: STIXGeneral;">g</span><span class="mi" id="MathJax-Span-489" style="font-family: STIXGeneral;">m</span><span class="mi" id="MathJax-Span-490" style="font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-491" style="font-family: STIXGeneral;">n</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.721em; left: 2.835em;"><span class="texatom" id="MathJax-Span-492"><span class="mrow" id="MathJax-Span-493"><span class="msubsup" id="MathJax-Span-494"><span style="display: inline-block; position: relative; width: 1.072em; height: 0px;"><span style="position: absolute; clip: rect(3.49em, 1000.32em, 4.155em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-495" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.869em; left: 0.314em;"><span class="texatom" id="MathJax-Span-496"><span class="mrow" id="MathJax-Span-497"><span class="mn" id="MathJax-Span-498" style="font-size: 50%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-499" style="font-size: 50%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-500" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.038em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-501" style="font-size: 70.7%; font-family: STIXGeneral;">∈</span><span class="texatom" id="MathJax-Span-502"><span class="mrow" id="MathJax-Span-503"><span class="mi" id="MathJax-Span-504" style="font-size: 70.7%; font-family: STIXNonUnicode; font-style: italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.033em;"></span></span></span></span><span class="mo" id="MathJax-Span-505" style="font-size: 70.7%; font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-506"><span style="display: inline-block; position: relative; width: 1.112em; height: 0px;"><span style="position: absolute; clip: rect(3.49em, 1000.34em, 4.155em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-507" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.869em; left: 0.354em;"><span class="texatom" id="MathJax-Span-508"><span class="mrow" id="MathJax-Span-509"><span class="mn" id="MathJax-Span-510" style="font-size: 50%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-511" style="font-size: 50%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-512" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.038em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-513" style="font-size: 70.7%; font-family: STIXGeneral;">∈</span><span class="texatom" id="MathJax-Span-514"><span class="mrow" id="MathJax-Span-515"><span class="mi" id="MathJax-Span-516" style="font-size: 70.7%; font-family: STIXNonUnicode; font-style: italic; text-rendering: optimizelegibility;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.094em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mspace" id="MathJax-Span-517" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-518" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.119em, 1005.18em, 4.365em, -1000em); top: -2.924em; right: 0em;"><span class="mtd" id="MathJax-Span-572"><span class="mrow" id="MathJax-Span-573"><span class="mspace" id="MathJax-Span-574" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-575" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="texatom" id="MathJax-Span-576"><span class="mrow" id="MathJax-Span-577"><span class="mi" id="MathJax-Span-578" style="font-family: STIXGeneral;">s</span><span class="mi" id="MathJax-Span-579" style="font-family: STIXGeneral;">u</span><span class="mi" id="MathJax-Span-580" style="font-family: STIXGeneral;">b</span><span class="mi" id="MathJax-Span-581" style="font-family: STIXGeneral;">j</span><span class="mi" id="MathJax-Span-582" style="font-family: STIXGeneral;">e</span><span class="mi" id="MathJax-Span-583" style="font-family: STIXGeneral;">c</span><span class="mi" id="MathJax-Span-584" style="font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mspace" id="MathJax-Span-585" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-586" style="font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mi" id="MathJax-Span-587" style="font-family: STIXGeneral;">o</span></span></span><span class="mspace" id="MathJax-Span-588" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-589" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.802em, 1000em, 4.147em, -1000em); top: -1.568em; right: 0em;"><span class="mtd" id="MathJax-Span-610"><span class="mrow" id="MathJax-Span-611"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.53em;"></span></span><span style="position: absolute; clip: rect(3.403em, 1012.58em, 9.418em, -1000em); top: -6.682em; left: 12.898em;"><span style="display: inline-block; position: relative; width: 12.581em; height: 0px;"><span style="position: absolute; clip: rect(2.098em, 1012.58em, 5.463em, -1000em); top: -5.377em; left: 0em;"><span class="mtd" id="MathJax-Span-519"><span class="mrow" id="MathJax-Span-520"><span class="mi" id="MathJax-Span-521"></span><span class="munderover" id="MathJax-Span-522" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px;"><span style="position: absolute; clip: rect(2.827em, 1001.2em, 4.622em, -1000em); top: -3.975em; left: 0em;"><span class="mo" id="MathJax-Span-523" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1000.97em, 4.255em, -1000em); top: -2.825em; left: 0.122em;"><span class="texatom" id="MathJax-Span-524"><span class="mrow" id="MathJax-Span-525"><span class="mi" id="MathJax-Span-526" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-527" style="font-size: 70.7%; font-family: STIXGeneral;">=</span><span class="mn" id="MathJax-Span-528" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.24em, 1000.45em, 4.147em, -1000em); top: -5.175em; left: 0.422em;"><span class="mi" id="MathJax-Span-529" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-530" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.951em; height: 0px;"><span style="position: absolute; clip: rect(3.136em, 1000.69em, 4.165em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-531" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.667em;"><span class="mi" id="MathJax-Span-532" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-533" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-534"><span style="display: inline-block; position: relative; width: 0.728em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-535" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mi" id="MathJax-Span-536" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-537" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-538" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-539" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-540" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-541" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-542" style="font-family: STIXGeneral; padding-left: 0.25em;">+</span><span class="mfrac" id="MathJax-Span-543" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.62em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.124em, 1000.43em, 4.163em, -1000em); top: -4.651em; left: 50%; margin-left: -0.229em;"><span class="mi" id="MathJax-Span-544" style="font-family: STIXGeneral; font-style: italic;">λ</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.126em, 1000.47em, 4.147em, -1000em); top: -3.289em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-545" style="font-family: STIXGeneral;">2</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(0.85em, 1000.62em, 1.267em, -1000em); top: -1.314em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.62em; height: 0px; --darkreader-inline-border-top: currentcolor;" data-darkreader-inline-border-top=""></span><span style="display: inline-block; width: 0px; height: 1.094em;"></span></span></span></span><span class="texatom" id="MathJax-Span-546"><span class="mrow" id="MathJax-Span-547"><span class="mo" id="MathJax-Span-548" style="font-family: STIXVariants;">|</span></span></span><span class="texatom" id="MathJax-Span-549"><span class="mrow" id="MathJax-Span-550"><span class="mo" id="MathJax-Span-551" style="font-family: STIXVariants;">|</span></span></span><span class="msubsup" id="MathJax-Span-552"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-553" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-554" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-555" style="font-family: STIXGeneral; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-556" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.622em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-557" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="texatom" id="MathJax-Span-558"><span class="mrow" id="MathJax-Span-559"><span class="mi" id="MathJax-Span-560" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-561" style="font-size: 70.7%; font-family: STIXGeneral;">+</span><span class="mn" id="MathJax-Span-562" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="texatom" id="MathJax-Span-563"><span class="mrow" id="MathJax-Span-564"><span class="mo" id="MathJax-Span-565" style="font-family: STIXVariants;">|</span></span></span><span class="msubsup" id="MathJax-Span-566"><span style="display: inline-block; position: relative; width: 0.749em; height: 0px;"><span style="position: absolute; clip: rect(3.112em, 1000.19em, 4.336em, -1000em); top: -3.975em; left: 0em;"><span class="texatom" id="MathJax-Span-567"><span class="mrow" id="MathJax-Span-568"><span class="mo" id="MathJax-Span-569" style="font-family: STIXVariants;">|</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1000.43em, 4.147em, -1000em); top: -4.392em; left: 0.32em;"><span class="mn" id="MathJax-Span-570" style="font-size: 70.7%; font-family: STIXGeneral;">2</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1000.43em, 4.147em, -1000em); top: -3.727em; left: 0.32em;"><span class="mn" id="MathJax-Span-571" style="font-size: 70.7%; font-family: STIXGeneral;">2</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.032em;"></span></span><span style="position: absolute; clip: rect(3.124em, 1005.87em, 4.354em, -1000em); top: -2.924em; left: 0em;"><span class="mtd" id="MathJax-Span-590"><span class="mrow" id="MathJax-Span-591"><span class="msubsup" id="MathJax-Span-592"><span style="display: inline-block; position: relative; width: 1.566em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-593" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="texatom" id="MathJax-Span-594"><span class="mrow" id="MathJax-Span-595"><span class="mi" id="MathJax-Span-596" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-597" style="font-size: 70.7%; font-family: STIXGeneral;">+</span><span class="mn" id="MathJax-Span-598" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-599" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-600" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mo" id="MathJax-Span-601" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-602"><span style="display: inline-block; position: relative; width: 0.728em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-603" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mi" id="MathJax-Span-604" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-605" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-606" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-607" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-608" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-609" style="font-family: STIXGeneral;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.361em, 1003.84em, 4.305em, -1000em); top: -1.568em; left: 0em;"><span class="mtd" id="MathJax-Span-612"><span class="mrow" id="MathJax-Span-613"><span class="msubsup" id="MathJax-Span-614"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-615" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mn" id="MathJax-Span-616" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-617" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-618" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.463em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-619" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="texatom" id="MathJax-Span-620"><span class="mrow" id="MathJax-Span-621"><span class="mi" id="MathJax-Span-622" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-623" style="font-size: 70.7%; font-family: STIXGeneral;">n</span><span class="mi" id="MathJax-Span-624" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-625" style="font-size: 70.7%; font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-626" style="font-family: STIXGeneral;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.682em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.362em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -3.303em; border-left: 0px solid; width: 0px; height: 7.226em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left" rowspacing="3pt" columnspacing="0em" displaystyle="true"><mtr><mtd><msubsup><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow><mo>⋆</mo></msubsup><mo>,</mo><msubsup><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow><mo>⋆</mo></msubsup><mo>=</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow></msub><mo>∈</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">X</mi></mrow><mo>,</mo><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow></msub><mo>∈</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">U</mi></mrow></mrow></msub><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace></mtd><mtd><mi></mi><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>T</mi></munderover><msub><mi>C</mi><mi>t</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>,</mo><msub><mi>u</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mfrac><mi>λ</mi><mn>2</mn></mfrac><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mi>u</mi><mi>t</mi></msub><mo>−</mo><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msubsup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mtd></mtr><mtr><mtd><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">s</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">j</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mspace width="thickmathspace"></mspace><mi mathvariant="normal">t</mi><mi mathvariant="normal">o</mi></mrow><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace></mtd><mtd><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>,</mo><msub><mi>u</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd></mtd><mtd><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow></msub><mo>,</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-21">% <![CDATA[
\begin{equation}
\begin{split}
    x_{1:T}^\star, u_{1:T}^\star = {\rm argmin}_{x_{1:T} \in \mathcal{X},u_{1:T}\in \mathcal{U}} \;\; & \sum_{t=1}^T C_t(x_t, u_t) + \frac{\lambda}{2}||u_t-u_{t+1}||_2^2 \\
    \;\; {\rm subject\; to} \;\; & x_{t+1} = f(x_t, u_t) \\
    & x_1 = x_{\rm init},
\end{split}
\end{equation} %]]></script>

<h1 id="example-time-varying-linear-control">Example: Time-Varying Linear Control</h1>

<p>This example shows how our package can be used to solve
a time-varying linear control (LQR) problem of the form</p>

<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;g&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;m&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;&lt;/mi&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/munderover&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msubsup&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msubsup&gt;&lt;msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;b&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;j&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;/mrow&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-627" style="width: 26.213em; display: inline-block;"><span style="display: inline-block; position: relative; width: 21.141em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(-0.917em, 1020.97em, 5.141em, -1000em); top: -2.362em; left: 0em;"><span class="mrow" id="MathJax-Span-628"><span class="mtable" id="MathJax-Span-629" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 20.832em; height: 0px;"><span style="position: absolute; clip: rect(3.237em, 1012.74em, 8.109em, -1000em); top: -5.53em; left: 0em;"><span style="display: inline-block; position: relative; width: 12.739em; height: 0px;"><span style="position: absolute; clip: rect(3.026em, 1012.74em, 4.512em, -1000em); top: -5.319em; right: 0em;"><span class="mtd" id="MathJax-Span-630"><span class="mrow" id="MathJax-Span-631"><span class="msubsup" id="MathJax-Span-632"><span style="display: inline-block; position: relative; width: 1.517em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-633" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.38em, 1000.57em, 4.157em, -1000em); top: -4.328em; left: 0.498em;"><span class="mo" id="MathJax-Span-634" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1001.07em, 4.155em, -1000em); top: -3.661em; left: 0.444em;"><span class="texatom" id="MathJax-Span-635"><span class="mrow" id="MathJax-Span-636"><span class="mn" id="MathJax-Span-637" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-638" style="font-size: 70.7%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-639" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-640" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-641" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.573em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-642" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.38em, 1000.57em, 4.157em, -1000em); top: -4.328em; left: 0.5em;"><span class="mo" id="MathJax-Span-643" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1001.07em, 4.155em, -1000em); top: -3.661em; left: 0.5em;"><span class="texatom" id="MathJax-Span-644"><span class="mrow" id="MathJax-Span-645"><span class="mn" id="MathJax-Span-646" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-647" style="font-size: 70.7%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-648" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-649" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-650" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 7.275em; height: 0px;"><span style="position: absolute; clip: rect(3.119em, 1002.82em, 4.365em, -1000em); top: -3.975em; left: 0em;"><span class="texatom" id="MathJax-Span-651"><span class="mrow" id="MathJax-Span-652"><span class="mi" id="MathJax-Span-653" style="font-family: STIXGeneral;">a</span><span class="mi" id="MathJax-Span-654" style="font-family: STIXGeneral;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-655" style="font-family: STIXGeneral;">g</span><span class="mi" id="MathJax-Span-656" style="font-family: STIXGeneral;">m</span><span class="mi" id="MathJax-Span-657" style="font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-658" style="font-family: STIXGeneral;">n</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.721em; left: 2.835em;"><span class="texatom" id="MathJax-Span-659"><span class="mrow" id="MathJax-Span-660"><span class="msubsup" id="MathJax-Span-661"><span style="display: inline-block; position: relative; width: 1.048em; height: 0px;"><span style="position: absolute; clip: rect(3.499em, 1000.3em, 4.155em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-662" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.011em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.869em; left: 0.29em;"><span class="texatom" id="MathJax-Span-663"><span class="mrow" id="MathJax-Span-664"><span class="mn" id="MathJax-Span-665" style="font-size: 50%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-666" style="font-size: 50%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-667" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.038em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-668" style="font-size: 70.7%; font-family: STIXGeneral;">=</span><span class="mo" id="MathJax-Span-669" style="font-size: 70.7%; font-family: STIXGeneral;">[</span><span class="msubsup" id="MathJax-Span-670"><span style="display: inline-block; position: relative; width: 1.072em; height: 0px;"><span style="position: absolute; clip: rect(3.49em, 1000.32em, 4.155em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-671" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.869em; left: 0.314em;"><span class="texatom" id="MathJax-Span-672"><span class="mrow" id="MathJax-Span-673"><span class="mn" id="MathJax-Span-674" style="font-size: 50%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-675" style="font-size: 50%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-676" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.038em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-677" style="font-size: 70.7%; font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-678"><span style="display: inline-block; position: relative; width: 1.112em; height: 0px;"><span style="position: absolute; clip: rect(3.49em, 1000.34em, 4.155em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-679" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.869em; left: 0.354em;"><span class="texatom" id="MathJax-Span-680"><span class="mrow" id="MathJax-Span-681"><span class="mn" id="MathJax-Span-682" style="font-size: 50%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-683" style="font-size: 50%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-684" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.038em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-685" style="font-size: 70.7%; font-family: STIXGeneral;">]</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mspace" id="MathJax-Span-686" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-687" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.119em, 1005.18em, 4.365em, -1000em); top: -2.924em; right: 0em;"><span class="mtd" id="MathJax-Span-720"><span class="mrow" id="MathJax-Span-721"><span class="mspace" id="MathJax-Span-722" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-723" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="texatom" id="MathJax-Span-724"><span class="mrow" id="MathJax-Span-725"><span class="mi" id="MathJax-Span-726" style="font-family: STIXGeneral;">s</span><span class="mi" id="MathJax-Span-727" style="font-family: STIXGeneral;">u</span><span class="mi" id="MathJax-Span-728" style="font-family: STIXGeneral;">b</span><span class="mi" id="MathJax-Span-729" style="font-family: STIXGeneral;">j</span><span class="mi" id="MathJax-Span-730" style="font-family: STIXGeneral;">e</span><span class="mi" id="MathJax-Span-731" style="font-family: STIXGeneral;">c</span><span class="mi" id="MathJax-Span-732" style="font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mspace" id="MathJax-Span-733" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-734" style="font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mi" id="MathJax-Span-735" style="font-family: STIXGeneral;">o</span></span></span><span class="mspace" id="MathJax-Span-736" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-737" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.802em, 1000em, 4.147em, -1000em); top: -1.568em; right: 0em;"><span class="mtd" id="MathJax-Span-758"><span class="mrow" id="MathJax-Span-759"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.53em;"></span></span><span style="position: absolute; clip: rect(3.403em, 1008.09em, 9.418em, -1000em); top: -6.682em; left: 12.739em;"><span style="display: inline-block; position: relative; width: 8.094em; height: 0px;"><span style="position: absolute; clip: rect(2.098em, 1008.09em, 5.463em, -1000em); top: -5.377em; left: 0em;"><span class="mtd" id="MathJax-Span-688"><span class="mrow" id="MathJax-Span-689"><span class="mi" id="MathJax-Span-690"></span><span class="munderover" id="MathJax-Span-691" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px;"><span style="position: absolute; clip: rect(2.827em, 1001.2em, 4.622em, -1000em); top: -3.975em; left: 0em;"><span class="mo" id="MathJax-Span-692" style="font-family: STIXSizeOneSym; vertical-align: -0.524em;">∑</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1000.97em, 4.255em, -1000em); top: -2.825em; left: 0.122em;"><span class="texatom" id="MathJax-Span-693"><span class="mrow" id="MathJax-Span-694"><span class="mi" id="MathJax-Span-695" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-696" style="font-size: 70.7%; font-family: STIXGeneral;">=</span><span class="mn" id="MathJax-Span-697" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.24em, 1000.45em, 4.147em, -1000em); top: -5.175em; left: 0.422em;"><span class="mi" id="MathJax-Span-698" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-699" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.62em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.126em, 1000.39em, 4.147em, -1000em); top: -4.651em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-700" style="font-family: STIXGeneral;">1</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.126em, 1000.47em, 4.147em, -1000em); top: -3.289em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-701" style="font-family: STIXGeneral;">2</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(0.85em, 1000.62em, 1.267em, -1000em); top: -1.314em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.62em; height: 0px; --darkreader-inline-border-top: currentcolor;" data-darkreader-inline-border-top=""></span><span style="display: inline-block; width: 0px; height: 1.094em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-702"><span style="display: inline-block; position: relative; width: 1.003em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-703" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.34em, 1000.52em, 4.147em, -1000em); top: -4.319em; left: 0.481em;"><span class="mi" id="MathJax-Span-704" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.416em, 1000.28em, 4.155em, -1000em); top: -3.753em; left: 0.41em;"><span class="mi" id="MathJax-Span-705" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-706"><span style="display: inline-block; position: relative; width: 0.951em; height: 0px;"><span style="position: absolute; clip: rect(3.136em, 1000.69em, 4.165em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-707" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.667em;"><span class="mi" id="MathJax-Span-708" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-709"><span style="display: inline-block; position: relative; width: 0.694em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-710" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.41em;"><span class="mi" id="MathJax-Span-711" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-712" style="font-family: STIXGeneral; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-713" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.003em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-714" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.34em, 1000.52em, 4.147em, -1000em); top: -4.319em; left: 0.481em;"><span class="mi" id="MathJax-Span-715" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.416em, 1000.28em, 4.155em, -1000em); top: -3.753em; left: 0.41em;"><span class="mi" id="MathJax-Span-716" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-717"><span style="display: inline-block; position: relative; width: 0.728em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-718" style="font-family: STIXGeneral; font-style: italic;">c</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mi" id="MathJax-Span-719" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.032em;"></span></span><span style="position: absolute; clip: rect(3.124em, 1006.21em, 4.354em, -1000em); top: -2.924em; left: 0em;"><span class="mtd" id="MathJax-Span-738"><span class="mrow" id="MathJax-Span-739"><span class="msubsup" id="MathJax-Span-740"><span style="display: inline-block; position: relative; width: 1.566em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-741" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="texatom" id="MathJax-Span-742"><span class="mrow" id="MathJax-Span-743"><span class="mi" id="MathJax-Span-744" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-745" style="font-size: 70.7%; font-family: STIXGeneral;">+</span><span class="mn" id="MathJax-Span-746" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-747" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-748" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.149em, 1000.65em, 4.147em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-749" style="font-family: STIXGeneral; font-style: italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.034em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.611em;"><span class="mi" id="MathJax-Span-750" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-751"><span style="display: inline-block; position: relative; width: 0.694em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-752" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.41em;"><span class="mi" id="MathJax-Span-753" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-754" style="font-family: STIXGeneral; padding-left: 0.25em;">+</span><span class="msubsup" id="MathJax-Span-755" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 0.562em; height: 0px;"><span style="position: absolute; clip: rect(3.124em, 1000.42em, 4.354em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-756" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.278em;"><span class="mi" id="MathJax-Span-757" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.361em, 1003.84em, 4.305em, -1000em); top: -1.568em; left: 0em;"><span class="mtd" id="MathJax-Span-760"><span class="mrow" id="MathJax-Span-761"><span class="msubsup" id="MathJax-Span-762"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-763" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mn" id="MathJax-Span-764" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-765" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-766" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.463em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-767" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="texatom" id="MathJax-Span-768"><span class="mrow" id="MathJax-Span-769"><span class="mi" id="MathJax-Span-770" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-771" style="font-size: 70.7%; font-family: STIXGeneral;">n</span><span class="mi" id="MathJax-Span-772" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-773" style="font-size: 70.7%; font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-774" style="font-family: STIXGeneral;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.682em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.362em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -3.303em; border-left: 0px solid; width: 0px; height: 7.226em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left" rowspacing="3pt" columnspacing="0em" displaystyle="true"><mtr><mtd><msubsup><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow><mo>⋆</mo></msubsup><mo>,</mo><msubsup><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow><mo>⋆</mo></msubsup><mo>=</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>τ</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow></msub><mo>=</mo><mo stretchy="false">[</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow></msub><mo>,</mo><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow></msub><mo stretchy="false">]</mo></mrow></msub><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace></mtd><mtd><mi></mi><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>T</mi></munderover><mfrac><mn>1</mn><mn>2</mn></mfrac><msubsup><mi>τ</mi><mi>t</mi><mi>T</mi></msubsup><msub><mi>C</mi><mi>t</mi></msub><msub><mi>τ</mi><mi>t</mi></msub><mo>+</mo><msubsup><mi>τ</mi><mi>t</mi><mi>T</mi></msubsup><msub><mi>c</mi><mi>t</mi></msub></mtd></mtr><mtr><mtd><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">s</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">j</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mspace width="thickmathspace"></mspace><mi mathvariant="normal">t</mi><mi mathvariant="normal">o</mi></mrow><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace></mtd><mtd><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>F</mi><mi>t</mi></msub><msub><mi>τ</mi><mi>t</mi></msub><mo>+</mo><msub><mi>f</mi><mi>t</mi></msub></mtd></mtr><mtr><mtd></mtd><mtd><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow></msub><mo>,</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-22">% <![CDATA[
\begin{equation}
\begin{split}
    x_{1:T}^\star, u_{1:T}^\star = {\rm argmin}_{\tau_{1:T}=[x_{1:T},u_{1:T}]} \;\; & \sum_{t=1}^T \frac{1}{2}\tau_t^T C_t \tau_t + \tau_t^T c_t \\
    \;\; {\rm subject\; to} \;\; & x_{t+1} = F_t \tau_t + f_t \\
    & x_1 = x_{\rm init},
\end{split}
\end{equation} %]]></script>

<p><a href="https://github.com/locuslab/mpc.pytorch/blob/master/examples/Time%20Varying%20Linear-Quadratic%20Control.ipynb">This code is available in a notebook here.</a></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.autograd</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">from</span> <span class="nn">mpc</span> <span class="kn">import</span> <span class="n">mpc</span>
<span class="kn">from</span> <span class="nn">mpc.mpc</span> <span class="kn">import</span> <span class="n">QuadCost</span><span class="p">,</span> <span class="n">LinDx</span>

<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">n_batch</span><span class="p">,</span> <span class="n">n_state</span><span class="p">,</span> <span class="n">n_ctrl</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span>
<span class="n">n_sc</span> <span class="o">=</span> <span class="n">n_state</span> <span class="o">+</span> <span class="n">n_ctrl</span>

<span class="c"># Randomly initialize a PSD quadratic cost and linear dynamics.</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">n_batch</span><span class="p">,</span> <span class="n">n_sc</span><span class="p">,</span> <span class="n">n_sc</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bmm</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="n">n_sc</span><span class="p">,</span> <span class="n">n_sc</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="n">n_sc</span><span class="p">)</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n_state</span><span class="p">)</span><span class="o">+</span><span class="n">alpha</span><span class="o">*</span><span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_state</span><span class="p">,</span> <span class="n">n_state</span><span class="p">))</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="n">n_state</span><span class="p">,</span> <span class="n">n_ctrl</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">R</span><span class="p">,</span> <span class="n">S</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c"># The initial state.</span>
<span class="n">x_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_batch</span><span class="p">,</span> <span class="n">n_state</span><span class="p">)</span>

<span class="c"># The upper and lower control bounds.</span>
<span class="n">u_lower</span> <span class="o">=</span> <span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="n">n_ctrl</span><span class="p">)</span>
<span class="n">u_upper</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="n">n_ctrl</span><span class="p">)</span>

<span class="n">x_lqr</span><span class="p">,</span> <span class="n">u_lqr</span><span class="p">,</span> <span class="n">objs_lqr</span> <span class="o">=</span> <span class="n">mpc</span><span class="o">.</span><span class="n">MPC</span><span class="p">(</span>
    <span class="n">n_state</span><span class="o">=</span><span class="n">n_state</span><span class="p">,</span>
    <span class="n">n_ctrl</span><span class="o">=</span><span class="n">n_ctrl</span><span class="p">,</span>
    <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span>
    <span class="n">u_lower</span><span class="o">=</span><span class="n">u_lower</span><span class="p">,</span> 
    <span class="n">u_upper</span><span class="o">=</span><span class="n">u_upper</span><span class="p">,</span>
    <span class="n">lqr_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">backprop</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">exit_unconverged</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="p">)(</span><span class="n">x_init</span><span class="p">,</span> <span class="n">QuadCost</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">LinDx</span><span class="p">(</span><span class="n">F</span><span class="p">))</span></code></pre></figure>

<h1 id="example-pendulum-control">Example: Pendulum Control</h1>

<p>This example shows how to do control in a simple pendulum environment
that we have implemented in PyTorch
<a href="https://github.com/locuslab/mpc.pytorch/blob/master/mpc/env_dx/pendulum.py">here</a>.
The state is the cosine/sin of the angle of the pendulum and
the velocity and the control is the torque to apply.
<a href="https://github.com/locuslab/mpc.pytorch/blob/master/examples/Pendulum%20Control.ipynb">The full source code for this example is available in a notebook here.</a></p>

<p>We’ll initialize the non-convex dynamics with:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">mpc.env_dx</span> <span class="kn">import</span> <span class="n">pendulum</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">((</span><span class="mf">10.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span> <span class="c"># Gravity, mass, length.</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">pendulum</span><span class="o">.</span><span class="n">PendulumDx</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">simple</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>Let’s do control to make the Pendulum swing up by solving the problem</p>

<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable columnalign=&quot;right left&quot; rowspacing=&quot;3pt&quot; columnspacing=&quot;0em&quot; displaystyle=&quot;true&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msubsup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;a&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;r&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;g&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;m&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;X&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;:&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;U&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;u&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;b&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;j&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;c&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;o&lt;/mi&gt;&lt;/mrow&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;mspace width=&quot;thickmathspace&quot; /&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;n&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;i&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-775" style="width: 23.736em; display: inline-block;"><span style="display: inline-block; position: relative; width: 19.124em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(0.01em, 1018.91em, 4.214em, -1000em); top: -2.362em; left: 0em;"><span class="mrow" id="MathJax-Span-776"><span class="mtable" id="MathJax-Span-777" style="padding-right: 0.167em; padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 18.816em; height: 0px;"><span style="position: absolute; clip: rect(2.281em, 1012.9em, 6.26em, -1000em); top: -4.608em; left: 0em;"><span style="display: inline-block; position: relative; width: 12.898em; height: 0px;"><span style="position: absolute; clip: rect(3.026em, 1012.9em, 4.512em, -1000em); top: -5.354em; right: 0em;"><span class="mtd" id="MathJax-Span-778"><span class="mrow" id="MathJax-Span-779"><span class="msubsup" id="MathJax-Span-780"><span style="display: inline-block; position: relative; width: 1.517em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-781" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.38em, 1000.57em, 4.157em, -1000em); top: -4.328em; left: 0.498em;"><span class="mo" id="MathJax-Span-782" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1001.07em, 4.155em, -1000em); top: -3.661em; left: 0.444em;"><span class="texatom" id="MathJax-Span-783"><span class="mrow" id="MathJax-Span-784"><span class="mn" id="MathJax-Span-785" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-786" style="font-size: 70.7%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-787" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-788" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-789" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 1.573em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-790" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.38em, 1000.57em, 4.157em, -1000em); top: -4.328em; left: 0.5em;"><span class="mo" id="MathJax-Span-791" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1001.07em, 4.155em, -1000em); top: -3.661em; left: 0.5em;"><span class="texatom" id="MathJax-Span-792"><span class="mrow" id="MathJax-Span-793"><span class="mn" id="MathJax-Span-794" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-795" style="font-size: 70.7%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-796" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-797" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-798" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 7.434em; height: 0px;"><span style="position: absolute; clip: rect(3.119em, 1002.82em, 4.365em, -1000em); top: -3.975em; left: 0em;"><span class="texatom" id="MathJax-Span-799"><span class="mrow" id="MathJax-Span-800"><span class="mi" id="MathJax-Span-801" style="font-family: STIXGeneral;">a</span><span class="mi" id="MathJax-Span-802" style="font-family: STIXGeneral;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-803" style="font-family: STIXGeneral;">g</span><span class="mi" id="MathJax-Span-804" style="font-family: STIXGeneral;">m</span><span class="mi" id="MathJax-Span-805" style="font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-806" style="font-family: STIXGeneral;">n</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.721em; left: 2.835em;"><span class="texatom" id="MathJax-Span-807"><span class="mrow" id="MathJax-Span-808"><span class="msubsup" id="MathJax-Span-809"><span style="display: inline-block; position: relative; width: 1.072em; height: 0px;"><span style="position: absolute; clip: rect(3.49em, 1000.32em, 4.155em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-810" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.869em; left: 0.314em;"><span class="texatom" id="MathJax-Span-811"><span class="mrow" id="MathJax-Span-812"><span class="mn" id="MathJax-Span-813" style="font-size: 50%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-814" style="font-size: 50%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-815" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.038em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-816" style="font-size: 70.7%; font-family: STIXGeneral;">∈</span><span class="texatom" id="MathJax-Span-817"><span class="mrow" id="MathJax-Span-818"><span class="mi" id="MathJax-Span-819" style="font-size: 70.7%; font-family: STIXNonUnicode; font-style: italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.033em;"></span></span></span></span><span class="mo" id="MathJax-Span-820" style="font-size: 70.7%; font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-821"><span style="display: inline-block; position: relative; width: 1.112em; height: 0px;"><span style="position: absolute; clip: rect(3.49em, 1000.34em, 4.155em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-822" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.869em; left: 0.354em;"><span class="texatom" id="MathJax-Span-823"><span class="mrow" id="MathJax-Span-824"><span class="mn" id="MathJax-Span-825" style="font-size: 50%; font-family: STIXGeneral;">1</span><span class="mo" id="MathJax-Span-826" style="font-size: 50%; font-family: STIXGeneral;">:</span><span class="mi" id="MathJax-Span-827" style="font-size: 50%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.038em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-828" style="font-size: 70.7%; font-family: STIXGeneral;">∈</span><span class="texatom" id="MathJax-Span-829"><span class="mrow" id="MathJax-Span-830"><span class="mi" id="MathJax-Span-831" style="font-size: 70.7%; font-family: STIXNonUnicode; font-style: italic; text-rendering: optimizelegibility;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.094em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mspace" id="MathJax-Span-832" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-833" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.119em, 1005.18em, 4.365em, -1000em); top: -3.851em; right: 0em;"><span class="mtd" id="MathJax-Span-846"><span class="mrow" id="MathJax-Span-847"><span class="mspace" id="MathJax-Span-848" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-849" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="texatom" id="MathJax-Span-850"><span class="mrow" id="MathJax-Span-851"><span class="mi" id="MathJax-Span-852" style="font-family: STIXGeneral;">s</span><span class="mi" id="MathJax-Span-853" style="font-family: STIXGeneral;">u</span><span class="mi" id="MathJax-Span-854" style="font-family: STIXGeneral;">b</span><span class="mi" id="MathJax-Span-855" style="font-family: STIXGeneral;">j</span><span class="mi" id="MathJax-Span-856" style="font-family: STIXGeneral;">e</span><span class="mi" id="MathJax-Span-857" style="font-family: STIXGeneral;">c</span><span class="mi" id="MathJax-Span-858" style="font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mspace" id="MathJax-Span-859" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-860" style="font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mi" id="MathJax-Span-861" style="font-family: STIXGeneral;">o</span></span></span><span class="mspace" id="MathJax-Span-862" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span><span class="mspace" id="MathJax-Span-863" style="height: 0em; vertical-align: 0em; width: 0.313em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.802em, 1000em, 4.147em, -1000em); top: -2.496em; right: 0em;"><span class="mtd" id="MathJax-Span-884"><span class="mrow" id="MathJax-Span-885"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.608em;"></span></span><span style="position: absolute; clip: rect(2.438em, 1005.87em, 6.475em, -1000em); top: -4.666em; left: 12.898em;"><span style="display: inline-block; position: relative; width: 5.918em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1003.26em, 4.324em, -1000em); top: -5.354em; left: 0em;"><span class="mtd" id="MathJax-Span-834"><span class="mrow" id="MathJax-Span-835"><span class="mi" id="MathJax-Span-836" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span class="mo" id="MathJax-Span-837" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-838"><span style="display: inline-block; position: relative; width: 0.728em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-839" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mi" id="MathJax-Span-840" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-841" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-842" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-843" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-844" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-845" style="font-family: STIXGeneral;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.124em, 1005.87em, 4.354em, -1000em); top: -3.851em; left: 0em;"><span class="mtd" id="MathJax-Span-864"><span class="mrow" id="MathJax-Span-865"><span class="msubsup" id="MathJax-Span-866"><span style="display: inline-block; position: relative; width: 1.566em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-867" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="texatom" id="MathJax-Span-868"><span class="mrow" id="MathJax-Span-869"><span class="mi" id="MathJax-Span-870" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span class="mo" id="MathJax-Span-871" style="font-size: 70.7%; font-family: STIXGeneral;">+</span><span class="mn" id="MathJax-Span-872" style="font-size: 70.7%; font-family: STIXGeneral;">1</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-873" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-874" style="font-family: STIXGeneral; font-style: italic; text-rendering: optimizelegibility; padding-left: 0.313em;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span><span class="mo" id="MathJax-Span-875" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-876"><span style="display: inline-block; position: relative; width: 0.728em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-877" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mi" id="MathJax-Span-878" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-879" style="font-family: STIXGeneral;">,</span><span class="msubsup" id="MathJax-Span-880" style="padding-left: 0.188em;"><span style="display: inline-block; position: relative; width: 0.784em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.48em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-881" style="font-family: STIXGeneral; font-style: italic;">u</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-882" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.013em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-883" style="font-family: STIXGeneral;">)</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.361em, 1003.84em, 4.305em, -1000em); top: -2.496em; left: 0em;"><span class="mtd" id="MathJax-Span-886"><span class="mrow" id="MathJax-Span-887"><span class="msubsup" id="MathJax-Span-888"><span style="display: inline-block; position: relative; width: 0.873em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-889" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="mn" id="MathJax-Span-890" style="font-size: 70.7%; font-family: STIXGeneral;">1</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-891" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="msubsup" id="MathJax-Span-892" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 1.463em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.45em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-893" style="font-family: STIXGeneral; font-style: italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.444em;"><span class="texatom" id="MathJax-Span-894"><span class="mrow" id="MathJax-Span-895"><span class="mi" id="MathJax-Span-896" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-897" style="font-size: 70.7%; font-family: STIXGeneral;">n</span><span class="mi" id="MathJax-Span-898" style="font-size: 70.7%; font-family: STIXGeneral;">i</span><span class="mi" id="MathJax-Span-899" style="font-size: 70.7%; font-family: STIXGeneral;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-900" style="font-family: STIXGeneral;">,</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.666em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.362em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.153em; border-left: 0px solid; width: 0px; height: 4.927em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable columnalign="right left" rowspacing="3pt" columnspacing="0em" displaystyle="true"><mtr><mtd><msubsup><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow><mo>⋆</mo></msubsup><mo>,</mo><msubsup><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow><mo>⋆</mo></msubsup><mo>=</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow></msub><mo>∈</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">X</mi></mrow><mo>,</mo><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>:</mo><mi>T</mi></mrow></msub><mo>∈</mo><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">U</mi></mrow></mrow></msub><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace></mtd><mtd><mi>C</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>,</mo><msub><mi>u</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">s</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">j</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mspace width="thickmathspace"></mspace><mi mathvariant="normal">t</mi><mi mathvariant="normal">o</mi></mrow><mspace width="thickmathspace"></mspace><mspace width="thickmathspace"></mspace></mtd><mtd><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>,</mo><msub><mi>u</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mtd></mtr><mtr><mtd></mtd><mtd><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><msub><mi>x</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow></msub><mo>,</mo></mtd></mtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-23">% <![CDATA[
\begin{equation}
\begin{split}
    x_{1:T}^\star, u_{1:T}^\star = {\rm argmin}_{x_{1:T} \in \mathcal{X},u_{1:T}\in \mathcal{U}} \;\; & C(x_t, u_t) \\
    \;\; {\rm subject\; to} \;\; & x_{t+1} = f(x_t, u_t) \\
    & x_1 = x_{\rm init},
\end{split}
\end{equation} %]]></script>

<p>where the cost function <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-901" style="width: 0.867em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.691em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.696em, 1000.69em, 2.725em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-902"><span class="mi" id="MathJax-Span-903" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.094em; border-left: 0px solid; width: 0px; height: 0.991em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math></span></span><script type="math/tex" id="MathJax-Element-24">C</script> is the distance from the nominal
states to the upright position.
Thus this optimization problem will find the control
sequence that minimizes this distance.
We can easily implement <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-904" style="width: 0.867em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.691em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.696em, 1000.69em, 2.725em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-905"><span class="mi" id="MathJax-Span-906" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.094em; border-left: 0px solid; width: 0px; height: 0.991em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi></math></span></span><script type="math/tex" id="MathJax-Element-25">C</script> as the quadratic function
that takes a weighted distance as</p>

<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2218;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msubsup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msubsup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-907" style="width: 12.445em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.023em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.467em, 1010.02em, 2.955em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-908"><span class="mi" id="MathJax-Span-909" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span class="mo" id="MathJax-Span-910" style="font-family: STIXGeneral;">(</span><span class="mi" id="MathJax-Span-911" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span class="mo" id="MathJax-Span-912" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-913" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="texatom" id="MathJax-Span-914" style="padding-left: 0.313em;"><span class="mrow" id="MathJax-Span-915"><span class="mo" id="MathJax-Span-916" style="font-family: STIXVariants;">|</span></span></span><span class="texatom" id="MathJax-Span-917"><span class="mrow" id="MathJax-Span-918"><span class="mo" id="MathJax-Span-919" style="font-family: STIXVariants;">|</span></span></span><span class="msubsup" id="MathJax-Span-920"><span style="display: inline-block; position: relative; width: 1.047em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.47em, 4.353em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-921" style="font-family: STIXGeneral; font-style: italic;">g</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-922" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">w</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-923" style="font-family: STIXGeneral; padding-left: 0.25em;">∘</span><span class="mo" id="MathJax-Span-924" style="font-family: STIXGeneral; padding-left: 0.25em;">(</span><span class="mi" id="MathJax-Span-925" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span class="mo" id="MathJax-Span-926" style="font-family: STIXGeneral; padding-left: 0.25em;">−</span><span class="msubsup" id="MathJax-Span-927" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.051em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-928" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -4.388em; left: 0.481em;"><span class="mo" id="MathJax-Span-929" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-930" style="font-family: STIXGeneral;">)</span><span class="texatom" id="MathJax-Span-931"><span class="mrow" id="MathJax-Span-932"><span class="mo" id="MathJax-Span-933" style="font-family: STIXVariants;">|</span></span></span><span class="msubsup" id="MathJax-Span-934"><span style="display: inline-block; position: relative; width: 0.749em; height: 0px;"><span style="position: absolute; clip: rect(3.112em, 1000.19em, 4.336em, -1000em); top: -3.975em; left: 0em;"><span class="texatom" id="MathJax-Span-935"><span class="mrow" id="MathJax-Span-936"><span class="mo" id="MathJax-Span-937" style="font-family: STIXVariants;">|</span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1000.43em, 4.147em, -1000em); top: -4.392em; left: 0.32em;"><span class="mn" id="MathJax-Span-938" style="font-size: 70.7%; font-family: STIXGeneral;">2</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.324em, 1000.43em, 4.147em, -1000em); top: -3.727em; left: 0.32em;"><span class="mn" id="MathJax-Span-939" style="font-size: 70.7%; font-family: STIXGeneral;">2</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.378em; border-left: 0px solid; width: 0px; height: 1.559em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>C</mi><mo stretchy="false">(</mo><mi>τ</mi><mo stretchy="false">)</mo><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mi>g</mi><mi>w</mi></msub><mo>∘</mo><mo stretchy="false">(</mo><mi>τ</mi><mo>−</mo><msup><mi>τ</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msubsup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mn>2</mn><mn>2</mn></msubsup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-26">C(\tau) = ||g_w\circ (\tau - \tau^\star)||_2^2</script>

<p>where <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-940" style="width: 1.328em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.037em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.748em, 1001.04em, 2.741em, -1000em); top: -2.362em; left: 0em;"><span class="mrow" id="MathJax-Span-941"><span class="msubsup" id="MathJax-Span-942"><span style="display: inline-block; position: relative; width: 1.047em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.47em, 4.353em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-943" style="font-family: STIXGeneral; font-style: italic;">g</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-944" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">w</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.362em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.327em; border-left: 0px solid; width: 0px; height: 0.945em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>g</mi><mi>w</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-27">g_w</script> is the weights on each component of the states
and actions and <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-945" style="width: 1.328em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.037em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.404em, 1001.04em, 2.546em, -1000em); top: -2.362em; left: 0em;"><span class="mrow" id="MathJax-Span-946"><span class="msubsup" id="MathJax-Span-947"><span style="display: inline-block; position: relative; width: 1.051em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-948" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -4.338em; left: 0.481em;"><span class="mo" id="MathJax-Span-949" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.362em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 1.13em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>τ</mi><mo>⋆</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-28">\tau^\star</script> is the goal location.
In proper quadratic form, this becomes</p>

<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msup&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msqrt&gt;&lt;msub&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;/msub&gt;&lt;/msqrt&gt;&lt;mo&gt;&amp;#x2218;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo&gt;&amp;#x22C6;&lt;/mo&gt;&lt;/msup&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msup&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-950" style="width: 17.802em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.343em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.009em, 1014.34em, 3.393em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-951"><span class="mi" id="MathJax-Span-952" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span class="mo" id="MathJax-Span-953" style="font-family: STIXGeneral;">(</span><span class="mi" id="MathJax-Span-954" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span class="mo" id="MathJax-Span-955" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-956" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="mfrac" id="MathJax-Span-957" style="padding-left: 0.313em;"><span style="display: inline-block; position: relative; width: 0.62em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.126em, 1000.39em, 4.147em, -1000em); top: -4.651em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-958" style="font-family: STIXGeneral;">1</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.126em, 1000.47em, 4.147em, -1000em); top: -3.289em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-959" style="font-family: STIXGeneral;">2</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(0.85em, 1000.62em, 1.267em, -1000em); top: -1.314em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.62em; height: 0px; --darkreader-inline-border-top: currentcolor;" data-darkreader-inline-border-top=""></span><span style="display: inline-block; width: 0px; height: 1.094em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-960"><span style="display: inline-block; position: relative; width: 1.003em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-961" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -4.388em; left: 0.481em;"><span class="mi" id="MathJax-Span-962" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mi" id="MathJax-Span-963" style="font-family: STIXGeneral; font-style: italic;">D</span><span class="mo" id="MathJax-Span-964" style="font-family: STIXGeneral;">(</span><span class="msubsup" id="MathJax-Span-965"><span style="display: inline-block; position: relative; width: 1.047em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.47em, 4.353em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-966" style="font-family: STIXGeneral; font-style: italic;">g</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-967" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">w</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-968" style="font-family: STIXGeneral;">)</span><span class="mi" id="MathJax-Span-969" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span class="mo" id="MathJax-Span-970" style="font-family: STIXGeneral; padding-left: 0.25em;">−</span><span class="mo" id="MathJax-Span-971" style="font-family: STIXGeneral; padding-left: 0.25em;">(</span><span class="msqrt" id="MathJax-Span-972"><span style="display: inline-block; position: relative; width: 1.809em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1001.05em, 4.353em, -1000em); top: -3.975em; left: 0.737em;"><span class="mrow" id="MathJax-Span-973"><span class="msubsup" id="MathJax-Span-974"><span style="display: inline-block; position: relative; width: 1.047em; height: 0px;"><span style="position: absolute; clip: rect(3.361em, 1000.47em, 4.353em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-975" style="font-family: STIXGeneral; font-style: italic;">g</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -3.825em; left: 0.5em;"><span class="mi" id="MathJax-Span-976" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">w</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(2.982em, 1001.07em, 3.377em, -1000em); top: -3.725em; left: 0.737em;"><span style="display: inline-block; position: relative; width: 1.072em; height: 0px;"><span style="position: absolute; font-family: STIXGeneral; top: -3.975em; left: 0em;">‾<span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; font-family: STIXGeneral; top: -3.975em; left: 0.572em;">‾<span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="font-family: STIXGeneral; position: absolute; top: -3.975em; left: 0.273em;">‾<span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(2.859em, 1000.77em, 4.158em, -1000em); top: -3.602em; left: 0em;"><span style="font-family: STIXVariants;">√</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mo" id="MathJax-Span-977" style="font-family: STIXGeneral; padding-left: 0.25em;">∘</span><span class="msubsup" id="MathJax-Span-978" style="padding-left: 0.25em;"><span style="display: inline-block; position: relative; width: 1.051em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-979" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -4.388em; left: 0.481em;"><span class="mo" id="MathJax-Span-980" style="font-size: 70.7%; font-family: STIXGeneral;">⋆</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-981"><span style="display: inline-block; position: relative; width: 0.856em; height: 0px;"><span style="position: absolute; clip: rect(3.126em, 1000.29em, 4.324em, -1000em); top: -3.975em; left: 0em;"><span class="mo" id="MathJax-Span-982" style="font-family: STIXGeneral;">)</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -4.388em; left: 0.333em;"><span class="mi" id="MathJax-Span-983" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mi" id="MathJax-Span-984" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.922em; border-left: 0px solid; width: 0px; height: 2.671em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>C</mi><mo stretchy="false">(</mo><mi>τ</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><msup><mi>τ</mi><mi>T</mi></msup><mi>D</mi><mo stretchy="false">(</mo><msub><mi>g</mi><mi>w</mi></msub><mo stretchy="false">)</mo><mi>τ</mi><mo>−</mo><mo stretchy="false">(</mo><msqrt><msub><mi>g</mi><mi>w</mi></msub></msqrt><mo>∘</mo><msup><mi>τ</mi><mo>⋆</mo></msup><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mi>τ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-29">C(\tau) = \frac{1}{2}\tau^T D(g_w) \tau - (\sqrt{g_w}\circ \tau^\star)^T \tau</script>

<p>Now we can implement this function in PyTorch:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">goal_weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="n">goal_state</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span> <span class="p">,</span><span class="mf">0.</span><span class="p">))</span>
<span class="n">ctrl_penalty</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span>
    <span class="n">goal_weights</span><span class="p">,</span>
    <span class="n">ctrl_penalty</span><span class="o">*</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dx</span><span class="o">.</span><span class="n">n_ctrl</span><span class="p">)</span>
<span class="p">))</span>
<span class="n">px</span> <span class="o">=</span> <span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">goal_weights</span><span class="p">)</span><span class="o">*</span><span class="n">goal_state</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">px</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dx</span><span class="o">.</span><span class="n">n_ctrl</span><span class="p">)))</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
    <span class="n">mpc_T</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mpc_T</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></code></pre></figure>

<p>Ignoring some of the more nuanced details we can
then do control with:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">nominal_states</span><span class="p">,</span> <span class="n">nominal_actions</span><span class="p">,</span> <span class="n">nominal_objs</span> <span class="o">=</span> <span class="n">mpc</span><span class="o">.</span><span class="n">MPC</span><span class="p">(</span>
    <span class="n">dx</span><span class="o">.</span><span class="n">n_state</span><span class="p">,</span> <span class="n">dx</span><span class="o">.</span><span class="n">n_ctrl</span><span class="p">,</span> <span class="n">mpc_T</span><span class="p">,</span>
    <span class="n">u_init</span><span class="o">=</span><span class="n">u_init</span><span class="p">,</span>
    <span class="n">u_lower</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">u_upper</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span>
    <span class="n">lqr_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">exit_unconverged</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">detach_unconverged</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">linesearch_decay</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">linesearch_decay</span><span class="p">,</span>
    <span class="n">max_linesearch_iter</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">max_linesearch_iter</span><span class="p">,</span>
    <span class="n">grad_method</span><span class="o">=</span><span class="n">GradMethods</span><span class="o">.</span><span class="n">AUTO_DIFF</span><span class="p">,</span>
    <span class="n">eps</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
<span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">QuadCost</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">dx</span><span class="p">)</span></code></pre></figure>

<p><img src="mpc.pytorch%20A%20fast%20and%20differentiable%20MPC%20solver%20for%20PyTorch_files/pendulum-swingup.gif" alt=""></p>

<h2 id="its-easy-to-alternatively-make-the-pendulum-spin-fast">It’s easy to alternatively make the Pendulum spin fast</h2>

<p>Just set the cost to maximize the velocity <span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x02D9;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-985" style="width: 0.637em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.518em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.268em, 1000.52em, 2.546em, -1000em); top: -2.362em; left: 0em;"><span class="mrow" id="MathJax-Span-986"><span class="texatom" id="MathJax-Span-987"><span class="mrow" id="MathJax-Span-988"><span class="munderover" id="MathJax-Span-989"><span style="display: inline-block; position: relative; width: 0.494em; height: 0px;"><span style="position: absolute; clip: rect(3.124em, 1000.49em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-990" style="font-family: STIXGeneral; font-style: italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.014em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.18em, 1000.22em, 3.624em, -1000em); top: -4.274em; left: 0.115em;"><span class="mo" id="MathJax-Span-991" style="font-family: STIXGeneral;">˙</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.362em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.085em; border-left: 0px solid; width: 0px; height: 1.299em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>θ</mi><mo>˙</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-30">\dot \theta</script>
and add a ridge term because the cost needs to be SPD.</p>

<span class="MathJax_Preview" style="color: inherit; --darkreader-inline-color: inherit; display: none;" data-darkreader-inline-color=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03F5;&lt;/mi&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/msup&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x02D9;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-992" style="width: 9.335em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.488em; height: 0px; font-size: 124%;"><span style="position: absolute; clip: rect(1.009em, 1007.49em, 3.393em, -1000em); top: -2.535em; left: 0em;"><span class="mrow" id="MathJax-Span-993"><span class="mi" id="MathJax-Span-994" style="font-family: STIXGeneral; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.022em;"></span></span><span class="mo" id="MathJax-Span-995" style="font-family: STIXGeneral;">(</span><span class="mi" id="MathJax-Span-996" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span class="mo" id="MathJax-Span-997" style="font-family: STIXGeneral;">)</span><span class="mo" id="MathJax-Span-998" style="font-family: STIXGeneral; padding-left: 0.313em;">=</span><span class="mi" id="MathJax-Span-999" style="font-family: STIXGeneral; font-style: italic; padding-left: 0.313em;">ϵ</span><span class="mfrac" id="MathJax-Span-1000"><span style="display: inline-block; position: relative; width: 0.62em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.126em, 1000.39em, 4.147em, -1000em); top: -4.651em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-1001" style="font-family: STIXGeneral;">1</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.126em, 1000.47em, 4.147em, -1000em); top: -3.289em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-1002" style="font-family: STIXGeneral;">2</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(0.85em, 1000.62em, 1.267em, -1000em); top: -1.314em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.62em; height: 0px; --darkreader-inline-border-top: currentcolor;" data-darkreader-inline-border-top=""></span><span style="display: inline-block; width: 0px; height: 1.094em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1003"><span style="display: inline-block; position: relative; width: 1.003em; height: 0px;"><span style="position: absolute; clip: rect(3.374em, 1000.43em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-1004" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; top: -4.388em; left: 0.481em;"><span class="mi" id="MathJax-Span-1005" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span><span class="mi" id="MathJax-Span-1006" style="font-family: STIXGeneral; font-style: italic;">τ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.016em;"></span></span><span class="mo" id="MathJax-Span-1007" style="font-family: STIXGeneral; padding-left: 0.25em;">−</span><span class="texatom" id="MathJax-Span-1008" style="padding-left: 0.25em;"><span class="mrow" id="MathJax-Span-1009"><span class="munderover" id="MathJax-Span-1010"><span style="display: inline-block; position: relative; width: 0.494em; height: 0px;"><span style="position: absolute; clip: rect(3.124em, 1000.49em, 4.158em, -1000em); top: -3.975em; left: 0em;"><span class="mi" id="MathJax-Span-1011" style="font-family: STIXGeneral; font-style: italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.014em;"></span></span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span><span style="position: absolute; clip: rect(3.18em, 1000.22em, 3.624em, -1000em); top: -4.274em; left: 0.115em;"><span class="mo" id="MathJax-Span-1012" style="font-family: STIXGeneral;">˙</span><span style="display: inline-block; width: 0px; height: 3.975em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.535em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.922em; border-left: 0px solid; width: 0px; height: 2.671em; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-left=""></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>C</mi><mo stretchy="false">(</mo><mi>τ</mi><mo stretchy="false">)</mo><mo>=</mo><mi>ϵ</mi><mfrac><mn>1</mn><mn>2</mn></mfrac><msup><mi>τ</mi><mi>T</mi></msup><mi>τ</mi><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>θ</mi><mo>˙</mo></mover></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-31">C(\tau) = \epsilon \frac{1}{2} \tau^T \tau - \dot \theta</script>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Q</span> <span class="o">=</span> <span class="mf">0.001</span><span class="o">*</span><span class="n">torch</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">dx</span><span class="o">.</span><span class="n">n_state</span><span class="o">+</span><span class="n">dx</span><span class="o">.</span><span class="n">n_ctrl</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
    <span class="n">mpc_T</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mpc_T</span><span class="p">,</span> <span class="n">n_batch</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></code></pre></figure>

<p><em>Voila.</em> 🎉</p>

<p><img src="mpc.pytorch%20A%20fast%20and%20differentiable%20MPC%20solver%20for%20PyTorch_files/pendulum-spin.gif" alt=""></p>

<h1 id="caveats">Caveats</h1>

<ul>
  <li>Solving control optimization problems can take many iterations
and the default parameters may not be useful for convergence on
your problem.
We have a <code class="highlighter-rouge">verbose</code> parameter so make analyzing
the convergence easier.</li>
</ul>

<h1 id="acknowledgments">Acknowledgments</h1>

<ul>
  <li>This website format is from
<a href="http://caffe.berkeleyvision.org/">Caffe</a>.</li>
</ul>

<h1 id="citations">Citations</h1>

<p>If you find this repository helpful for your research
please consider citing the control-limited DDP paper
and our paper on differentiable MPC.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@inproceedings{tassa2014control,
  title={Control-limited differential dynamic programming},
  author={Tassa, Yuval and Mansard, Nicolas and Todorov, Emo},
  booktitle={Robotics and Automation (ICRA), 2014 IEEE International Conference on},
  pages={1168--1175},
  year={2014},
  organization={IEEE}
}

@article{amos2018differentiable,
  title={{Differentiable MPC for End-to-end Planning and Control}},
  author={Brandon Amos and Ivan Jimenez and Jacob Sacks and Byron Boots and J. Zico Kolter},
  booktitle={{Advances in Neural Information Processing Systems}},
  year={2018}
}
</code></pre></div></div>

<h1 id="licensing">Licensing</h1>

<p>Unless otherwise stated, the source code is copyright
Carnegie Mellon University and licensed under the
MIT License.</p>

<h1 id="appendix">Appendix</h1>

<h2 id="mpcmpc-reference">mpc.MPC Reference</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">MPC</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="s">"""A differentiable box-constrained iLQR solver.

    This provides a differentiable solver for the following box-constrained
    control problem with a quadratic cost (defined by C and c) and
    non-linear dynamics (defined by f):

        min_{tau={x,u}} sum_t 0.5 tau_t^T C_t tau_t + c_t^T tau_t
                        s.t. x_{t+1} = f(x_t, u_t)
                            x_0 = x_init
                            u_lower &lt;= u &lt;= u_upper

    This implements the Control-Limited Differential Dynamic Programming
    paper with a first-order approximation to the non-linear dynamics:
    https://homes.cs.washington.edu/~todorov/papers/TassaICRA14.pdf

    Some of the notation here is from Sergey Levine's notes:
    http://rll.berkeley.edu/deeprlcourse/f17docs/lecture_8_model_based_planning.pdf

    Required Args:
        n_state, n_ctrl, T

    Optional Args:
        u_lower, u_upper: The lower- and upper-bounds on the controls.
            These can either be floats or shaped as [T, n_batch, n_ctrl]
        u_init: The initial control sequence, useful for warm-starting:
            [T, n_batch, n_ctrl]
        lqr_iter: The number of LQR iterations to perform.
        grad_method: The method to compute the Jacobian of the dynamics.
            GradMethods.ANALYTIC: Use a manually-defined Jacobian.
                + Fast and accurate, use this if possible
            GradMethods.AUTO_DIFF: Use PyTorch's autograd.
                + Slow
            GradMethods.FINITE_DIFF: Use naive finite differences
                + Inaccurate
        delta_u (float): The amount each component of the controls
            is allowed to change in each LQR iteration.
        verbose (int):
            -1: No output or warnings
             0: Warnings
            1+: Detailed iteration info
        eps: Termination threshold, on the norm of the full control
             step (without line search)
        back_eps: `eps` value to use in the backwards pass.
        n_batch: May be necessary for now if it can't be inferred.
                 TODO: Infer, potentially remove this.
        linesearch_decay (float): Multiplicative decay factor for the
            line search.
        max_linesearch_iter (int): Can be used to disable the line search
            if 1 is used for some problems the line search can
            be harmful.
        exit_unconverged: Assert False if a fixed point is not reached.
        detach_unconverged: Detach examples from the graph that do
            not hit a fixed point so they are not differentiated through.
        backprop: Allow the solver to be differentiated through.
        slew_rate_penalty (float): Penalty term applied to
            ||u_t - u_{t+1}||_2^2 in the objective.
        prev_ctrl: The previous nominal control sequence to initialize
            the solver with.
        not_improved_lim: The number of iterations to allow that don't
            improve the objective before returning early.
        best_cost_eps: Absolute threshold for the best cost
            to be updated.
    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">n_state</span><span class="p">,</span> <span class="n">n_ctrl</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span>
            <span class="n">u_lower</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">u_upper</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">u_zero_I</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">u_init</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">lqr_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">grad_method</span><span class="o">=</span><span class="n">GradMethods</span><span class="o">.</span><span class="n">ANALYTIC</span><span class="p">,</span>
            <span class="n">delta_u</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">eps</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span>
            <span class="n">back_eps</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span>
            <span class="n">n_batch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">linesearch_decay</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="n">max_linesearch_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">exit_unconverged</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">detach_unconverged</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">backprop</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">slew_rate_penalty</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">prev_ctrl</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">not_improved_lim</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">best_cost_eps</span><span class="o">=</span><span class="mf">1e-4</span>
    <span class="p">):</span></code></pre></figure>

<h2 id="mpc-algorithm">MPC Algorithm</h2>

<p><img src="mpc.pytorch%20A%20fast%20and%20differentiable%20MPC%20solver%20for%20PyTorch_files/mpc-alg.png" alt=""></p>

      </section>
    </div>
    <script type="text/x-mathjax-config;executed=true">
     MathJax.Hub.Config({
         tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
     });
    </script>
    <script type="text/javascript" async="" src="mpc.pytorch%20A%20fast%20and%20differentiable%20MPC%20solver%20for%20PyTorch_files/MathJax.js">
    </script>
  

<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px; --darkreader-inline-border-top: currentcolor; --darkreader-inline-border-right: currentcolor; --darkreader-inline-border-bottom: currentcolor; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-size-adjust: none; font-family: STIXSizeOneSym, sans-serif; --darkreader-inline-border-top: currentcolor; --darkreader-inline-border-right: currentcolor; --darkreader-inline-border-bottom: currentcolor; --darkreader-inline-border-left: currentcolor;" data-darkreader-inline-border-top="" data-darkreader-inline-border-right="" data-darkreader-inline-border-bottom="" data-darkreader-inline-border-left=""></div></div></body><grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration></html>